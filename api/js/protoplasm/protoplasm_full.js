// All Protoplasm source code (no on-demand loading)
if(typeof Protoplasm=="undefined"){var Protoplasm=function(){var b="1.7.0.0";var g="1.8.3";var h="https://ajax.googleapis.com/ajax/libs/prototype/"+b+"/prototype.js";var d="https://ajax.googleapis.com/ajax/libs/scriptaculous/"+g+"/";var e=source=loaded=failed=false;var i;var c=[];var a=[];var f={};return{Version:"0.1",base:function(j){return i+j+"/"},load:function(){function j(l){var m=l.replace(/_.*|\./g,"");m=parseInt(m+"0".times(4-m.length));return l.indexOf("_")>-1?m-1:m}failed=false;if(typeof Prototype=="undefined"){Protoplasm.require(h,Protoplasm.load);return}else{if(j(Prototype.Version)<j(b)){failed=true;throw ("Protoplasm requires the Prototype JavaScript framework >= "+b)}}var k=/protoplasm(_[a-z]*)?\.js(\?.*)?$/;$$("head script[src]").findAll(function(l){return l.src.match(k)}).each(function(n){var o=n.src.match(k),m=n.src.match(/\?.*load=([a-z,]*)/);i=n.src.replace(k,"");loaded=true;if(o[1]=="_full"){e=true;return}if(o[1]=="_src"){source=true}var l=(m?m[1].split(","):a);if(l){l.each(Protoplasm.use)}})},loadStylesheet:function(k,l){if(l){k=Protoplasm.full?i+"/protoplasm_full.css":i+l+"/"+k}if(!$$("head link[rel=stylesheet]").find(function(m){return m.href==k})){var j=new Element("link",{rel:"stylesheet",type:"text/css",href:k});$$("head")[0].appendChild(j)}},register:function(k,j){f[k]=j},require:function(m,o){if(c.indexOf(m)>-1){if(o){o()}return}c.push(m);try{if(document.loaded){throw ("Already loaded")}document.write('<script type="text/javascript" src="'+m+'"><\/script>');if(o){var j="_script_onload_"+c.length;window[j]=o;document.write('<script type="text/javascript">');document.write("window."+j+"(); delete window."+j+";");document.write("<\/script>")}}catch(n){var k=false;var l=new Element("script",{type:"text/javascript",src:m});if(o){l.onload=l.onreadystatechange=function(){var p=this.readyState;if(k||(p&&p!="complete"&&p!="loaded")){return}k=true;o()}}$$("head")[0].appendChild(l)}},transform:function(l,k){var m=Array.prototype.slice.call(arguments,2);function j(n){if(l in f){$$(k).each(function(o){var p=new f[l](o,m[0],m[1],m[2],m[3])})}}if(document.loaded){j()}else{document.on("dom:loaded",j)}return new Protoplasm.Transformer(l)},use:function(j,k){if(Object.isArray(j)){j.each(Protoplasm.use)}if(failed){throw ("Protoplasm loading failed, cannot include controls")}else{if(!loaded){a.push(j)}else{if(!Protoplasm.full&&!(j in f)){Protoplasm.require(i+j+"/"+j+(source?"_src":"")+".js",k)}}}return new Protoplasm.Transformer(j)},useScriptaculous:function(j,k){Protoplasm.require(d+j+".js",k)},Transformer:function(j){return{use:Protoplasm.use,transform:function(){var k=Array.prototype.slice.call(arguments,0);k.unshift(j);return Protoplasm.transform.apply(Protoplasm,k)}}}}}()}Protoplasm.load();if(window.Control==undefined){Control={}}Control.Accordion=Class.create();Control.Accordion.prototype={initialize:function(a,b){this.container=$(a);this.lastExpandedTab=null;this.accordionTabs=new Array();this.setOptions(b);this._attachBehaviors();for(var c=1;c<this.accordionTabs.length;c++){this.accordionTabs[c].collapse();this.accordionTabs[c].content.style.display="none"}this.lastExpandedTab=this.accordionTabs[0];this.lastExpandedTab.content.style.height=this.options.panelHeight+"px";this.lastExpandedTab.showExpanded()},setOptions:function(a){this.options=Object.extend({panelHeight:200,onHideTab:null,onShowTab:null},a||{})},showTabByIndex:function(c,b){var a=arguments.length==1?true:b;this.showTab(this.accordionTabs[c],a)},showTab:function(f,d,e){var c=arguments.length==1?true:d;if(this.options.onHideTab){this.options.onHideTab(this.lastExpandedTab)}this.lastExpandedTab.showCollapsed();this.lastExpandedTab.content.style.height=(this.options.panelHeight-1)+"px";f.content.style.display="";var b=this;var a=this.lastExpandedTab;if(c){new Control.Accordion.Animation(this.lastExpandedTab.content,f.content,1,this.options.panelHeight,100,10,{complete:function(){b.showTabDone(a,e)}});this.lastExpandedTab=f}else{this.lastExpandedTab.content.style.height="1px";f.content.style.height=this.options.panelHeight+"px";this.lastExpandedTab=f;this.showTabDone(a)}},showTabDone:function(a,b){a.content.style.display="none";this.lastExpandedTab.showExpanded();if(!b&&this.options.onShowTab){this.options.onShowTab(this.lastExpandedTab)}},_attachBehaviors:function(){var a=this._getDirectChildrenByTag(this.container,"DIV");for(var b=0;b<a.length;b++){var e=this._getDirectChildrenByTag(a[b],"DIV");if(e.length!=2){continue}var c=e[0];var d=e[1];this.accordionTabs.push(new Control.Accordion.Tab(this,c,d))}},_getDirectChildrenByTag:function(f,d){var b=new Array();var a=f.childNodes;for(var c=0;c<a.length;c++){if(a[c]&&a[c].tagName&&a[c].tagName==d){b.push(a[c])}}return b}};Control.Accordion.Tab=Class.create();Control.Accordion.Tab.prototype={initialize:function(a,b,c){this.accordion=a;this.titleBar=b;this.content=c;this._attachBehaviors()},collapse:function(){this.showCollapsed();this.content.style.height="1px"},showCollapsed:function(){this.expanded=false;if(this.accordion.options.collapsedClass){this.titleBar.className=this.accordion.options.collapsedClass}this.content.style.overflow="hidden"},showExpanded:function(){this.expanded=true;if(this.accordion.options.expandedClass){this.titleBar.className=this.accordion.options.expandedClass}this.content.style.overflow="visible"},titleBarClicked:function(a){if(this.accordion.lastExpandedTab!=this){this.accordion.showTab(this)}},hover:function(a){if(!this.expanded&&this.accordion.options.hoverClass){this.titleBar.className=this.accordion.options.hoverClass}},unhover:function(a){if(this.expanded){if(this.accordion.options.expandedClass){this.titleBar.className=this.accordion.options.expandedClass}}else{if(this.accordion.options.collapsedClass){this.titleBar.className=this.accordion.options.collapsedClass}}},_attachBehaviors:function(){this.titleBar.onclick=this.titleBarClicked.bindAsEventListener(this);this.titleBar.onmouseover=this.hover.bindAsEventListener(this);this.titleBar.onmouseout=this.unhover.bindAsEventListener(this)}};Control.Accordion.Animation=Class.create({initialize:function(f,e,g,a,d,b,c){this.e1=$(f);this.e2=$(e);this.start=g;this.end=a;this.duration=d;this.steps=b;this.options=arguments[6]||{};this.accordionSize()},accordionSize:function(){if(this.isFinished()){this.e1.style.height=this.start+"px";this.e2.style.height=this.end+"px";if(this.options.complete){this.options.complete(this)}return}if(this.timer){clearTimeout(this.timer)}var a=Math.round(this.duration/this.steps);var b=this.steps>0?(parseInt(this.e1.offsetHeight)-this.start)/this.steps:0;this.resizeBy(b);this.duration-=a;this.steps--;this.timer=setTimeout(this.accordionSize.bind(this),a)},isFinished:function(){return this.steps<=0},resizeBy:function(b){var d=this.e1.offsetHeight;var a=this.e2.offsetHeight;var c=parseInt(b);if(b!=0){this.e1.style.height=(d-c)+"px";this.e2.style.height=(a+c)+"px"}}});if(typeof Protoplasm!="undefined"){Protoplasm.register("accordion",Control.Accordion)};if(typeof Control=="undefined"){Control={}}Control.ColorPicker=Class.create({initialize:function(f,c){this.element=$(f);if(cp=this.element.retrieve("colorpicker")){cp.destroy()}this.options=Object.extend({className:"colorpickerControl"},c||{});this.colorpicker=new Control.ColorPicker.Panel({onSelect:this.colorSelected.bind(this)});if(typeof Protoplasm!="undefined"){Protoplasm.loadStylesheet("colorpicker.css","colorpicker")}this.open=false;this.dialog=new Element("div",{style:"position:absolute;"});var b=new Element("div",{"class":this.options.className});b.appendChild(this.colorpicker.element);this.dialog.appendChild(b);this.wrapper=this.element.wrap(new Element("div"));this.wrapper.style.position="relative";var g=this.element.getLayout();var e=g.get("height")-2;var a=g.get("padding-top");if(a<1){a=1;e-=(a-g.get("padding-top"))*2}var d=g.get("padding-right");if(d<1){d=1}this.swatch=new Element("div",{"class":"inputExtension",title:"Open color palette"});this.swatch.setStyle({border:"1px solid gray",position:"absolute",fontSize:"1px",width:e+"px",height:e+"px",backgroundColor:this.element.value});this.wrapper.appendChild(this.swatch);this.swatch.clonePosition(this.element,{setWidth:false,setHeight:false,offsetTop:a+g.get("border-top"),offsetLeft:g.get("padding-box-width")+1+g.get("border-left")});this.oldPadding=this.element.style.paddingRight;this.element.style.paddingRight=(e+3+g.get("padding-left")+d)+"px";this.element.maxLength=7;this.listeners=[this.element.on("change",this.textChanged.bindAsEventListener(this)),this.element.on("blur",this.hide.bindAsEventListener(this)),this.swatch.on("click",this.toggle.bindAsEventListener(this)),this.swatch.on("selectstart",Event.stop)];this.clickListener=null;this.element.store("colorpicker",this);this.destructor=Event.on(window,"unload",this.destroy.bind(this))},destroy:function(){for(var a=0;a<this.listeners.length;a++){this.listeners[a].stop()}if(this.clickListener){this.clickListener.stop()}this.wrapper.parentNode.replaceChild(this.element,this.wrapper);this.element.style.paddingRight=this.oldPadding;this.element.store("colorpicker",null);this.destructor.stop()},colorSelected:function(a){this.element.value=a;this.swatch.style.backgroundColor=a;this.hide()},textChanged:function(a){this.swatch.style.backgroundColor=this.element.value},toggle:function(a){if(this.open){this.hide()}else{this.show()}},show:function(c){if(!this.open){var b=this.element.getLayout();this.swatch.parentNode.appendChild(this.dialog);var a=b.get("border-box-height")-b.get("border-bottom");this.dialog.clonePosition(this.element,{setWidth:false,setHeight:false,offsetTop:a});this.clickListener=document.on("click",this.clickHandler.bindAsEventListener(this));this.open=true}},hide:function(a){if(this.open){if(this.clickListener){this.clickListener.stop()}this.dialog.remove();this.open=false}},clickHandler:function(b){var a=Event.element(b);do{if(a==this.swatch||a==this.dialog){return}}while(a=a.parentNode);this.hide()}});Control.ColorPicker.Panel=Class.create({initialize:function(a){this.options=Object.extend({addLabel:"Add",colors:Array("#000000","#993300","#333300","#003300","#003366","#000080","#333399","#333333","#800000","#FF6600","#808000","#008000","#008080","#0000FF","#666699","#808080","#FF0000","#FF9900","#99CC00","#339966","#33CCCC","#3366FF","#800080","#969696","#FF00FF","#FFCC00","#FFFF00","#00FF00","#00FFFF","#00CCFF","#993366","#C0C0C0","#FF99CC","#FFCC99","#FFFF99","#CCFFCC","#CCFFFF","#99CCFF","#CC99FF","#FFFFFF"),onSelect:Prototype.emptyFunction},a||{});this.customSwatches=[];this.activeCustom=null,this.element=this.create()},create:function(){var q=document.createElement("div");var a=this.options.colors;var p,n;var o=new Element("table",{cellPadding:0,cellSpacing:0,border:0});for(var f=0;f<5;++f){p=o.insertRow(f);for(var e=0;e<8;++e){n=p.insertCell(e);Element.setStyle(n,{border:"0px",padding:"0px"});var d=a[(8*f)+e];var m=new Element("div",{style:"width:15px;height:15px;font-size:1px;border:1px solid #EEEEEE;background-color:"+d+";padding:0"});m.on("click",this.clickListener(d));m.on("mouseover",this.hoverListener(d));n.appendChild(m)}}this.addSpacerRow(o,5);p=o.insertRow(6);var k=this.loadSetting("customColors")?this.loadSetting("customColors").split(","):new Array();this.customSwatches=[];for(var f=0;f<8;++f){n=p.insertCell(f);Element.setStyle(n,{border:"0",padding:"0"});var d=k[f]?k[f]:"#000000";var m=new Element("div",{style:"width:15px;height:15px;fontSize:15px;border:1px solid #EEEEEE;background-color:"+d+";padding:0"});n.appendChild(m);m.on("click",this.customClickListener(d,m));m.on("mouseover",this.hoverListener(d));this.customSwatches.push(m)}this.addSpacerRow(o,7);p=o.insertRow(8);n=p.insertCell(0);Element.setStyle(n,{border:"0",padding:"0"});n.colSpan=8;var b=new Element("table",{cellspacing:0,cellpadding:0,border:0,style:"width:136px;"});n.appendChild(b);p=b.insertRow(0);n=p.insertCell(0);Element.setStyle(n,{border:"0",padding:"0","vertical-align":"middle"});var g=new Element("div",{style:"width:15px;height:15px;fontSize:15px;border:1px solid #EEEEEE;background-color:#000000"});n.appendChild(g);this.previewSwatch=g;n=p.insertCell(1);Element.setStyle(n,{border:"0",padding:"0","vertical-align":"middle","text-align":"center"});var l=new Element("input",{type:"text",value:"#000000",style:"width:70px;border:1px solid gray"});l.on("keyup",function(i){this.previewSwatch.style.backgroundColor=l.value}.bindAsEventListener(this));n.appendChild(l);this.customInput=l;n=p.insertCell(2);Element.setStyle(n,{border:"0",padding:"0","vertical-align":"middle","text-align":"right"});var h=new Element("input",{type:"button",value:this.options.addLabel,style:"width:40px;border:1px solid gray"});h.on("click",function(s){var j=0;if(this.activeCustom){for(var r=0;r<this.customSwatches.length;++r){if(this.customSwatches[r]==this.activeCustom){j=r;break}}this.activeCustom.style.border="1px solid #EEEEEE";this.activeCustom=null}else{var t=this.loadSetting("customColorIndex");if(t){j=(parseInt(t)+1)%8}}this.saveSetting("customColorIndex",j);k[j]=this.customSwatches[j].style.backgroundColor=this.customInput.value;this.customSwatches[j].onclick=this.customClickListener(k[j],this.customSwatches[j]);this.customSwatches[j].onmouseover=this.hoverListener(k[j]);this.saveSetting("customColors",k.join(","))}.bindAsEventListener(this));n.appendChild(h);var c=new Element("form",{style:"margin:0;padding:0"});c.onsubmit=function(){if(this.activeCustom){this.activeCustom.style.border="1px solid #EEEEEE"}this.activeCustom=null;this.editor.setDialogColor(this.customInput.value);return false}.bindAsEventListener(this);c.appendChild(o);q.appendChild(c);return q},addSpacerRow:function(b,a){var c=b.insertRow(a);cell=c.insertCell(0);cell.colSpan=8;Element.setStyle(cell,{border:"0",padding:"0"});cell.appendChild(new Element("hr",{style:"color:gray;background-color:gray;height:1px;border:0;margin-top:3px;margin-bottom:3px;padding:0"}));return c},clickListener:function(a){return function(b){if(this.activeCustom){this.activeCustom.style.border="1px solid #EEEEEE"}this.activeCustom=null;this.options.onSelect(a)}.bindAsEventListener(this)},customClickListener:function(a,b){return function(c){if(c.ctrlKey){if(this.activeCustom){this.activeCustom.style.border="1px solid #EEEEEE"}this.activeCustom=b;this.activeCustom.style.border="1px solid #FF0000"}else{this.activeCustom=null;this.options.onSelect(a)}}.bindAsEventListener(this)},hoverListener:function(a){return function(b){this.previewSwatch.style.backgroundColor=a;this.customInput.value=a}.bindAsEventListener(this)},loadSetting:function(b){b="colorpicker_"+b;var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null},saveSetting:function(c,d,e){c="colorpicker_"+c;if(!e){e=180}var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString();document.cookie=c+"="+d+a+"; path=/"},clearSetting:function(a){this.saveSetting(a,"",-1)}});if(typeof Protoplasm!="undefined"){Protoplasm.register("colorpicker",Control.ColorPicker)};if(typeof Control=="undefined"){Control={}}Control.DatePicker=Class.create({initialize:function(element,options){this.element=$(element);if(dp=this.element.retrieve("datepicker")){dp.destroy()}this.wrapper=this.element.wrap(new Element("div"));this.wrapper.style.position="relative";options=Object.extend({datePicker:true,timePicker:false},options||{});if(window.Protoplasm!=undefined){var basePath=Protoplasm.base("datepicker");if(basePath){if(!options.icon){if(options.datePicker){options.icon=basePath+"calendar.png"}else{options.icon=basePath+"clock.png"}}Protoplasm.loadStylesheet("datepicker.css","datepicker")}}this.handlers={onClick:options.onClick,onHover:options.onHover,onSelect:options.onSelect};this.options=Object.extend(options||{},{onClick:this.pickerClicked.bind(this),onHover:this.dateHover.bind(this),onSelect:this.datePicked.bind(this)});var locale=this.options&&this.options.locale?this.options.locale:"en_US";try{this.setLocale(new Control.DatePicker.i18n(locale))}catch(e){var re=/datepicker.js$/;var base=$$("head script[src]").find(function(s){return s.src.match(re)}).src.replace(re,"");new Ajax.Request(base+"locales/"+locale+".js",{onSuccess:function(transport){eval(transport.responseText);this.setLocale(new Control.DatePicker.i18n(locale))}.bind(this),onFailure:function(transport){this.setLocale(new Control.DatePicker.i18n("en_US"))}.bind(this)})}this.datepicker=null;this.originalValue=null;this.hideTimeout=null;if(this.options.icon){this.element.style.background="url("+this.options.icon+") right center no-repeat #FFF";this.oldPadding=this.element.style.paddingRight;this.element.style.paddingRight="20px"}this.listeners=[];this.listeners.push(this.element.on("click",this.toggle.bindAsEventListener(this)));this.listeners.push(this.element.on("keydown",this.keyHandler.bindAsEventListener(this)));this.listeners.push(document.on("keydown",this.docKeyHandler.bindAsEventListener(this)));this.hidePickerListener=null;this.pickerActive=false;this.element.store("datepicker",this);this.destructor=Event.on(window,"unload",this.destroy.bind(this))},setLocale:function(a){this.i18n=a;this.options=this.i18n.inheritOptions(this.options);if(this.options.timePicker&&this.options.datePicker){this.options.currentFormat=this.options.dateTimeFormat}else{if(this.options.timePicker){this.options.currentFormat=this.options.timeFormat}else{this.options.currentFormat=this.options.dateFormat}}this.options.date=Control.DatePicker.DateFormat.parseFormat(this.element.value,this.options.currentFormat)},destroy:function(){for(var a=0;a<this.listeners.length;a++){this.listeners[a].stop()}if(this.hidePickerListener){this.hidePickerListener.stop()}this.wrapper.parentNode.replaceChild(this.element,this.wrapper);this.element.style.paddingRight=this.oldPadding;this.element.store("datepicker",null);this.destructor.stop()},tr:function(a){return this.i18n.tr(a)},delayedHide:function(a){this.hideTimeout=setTimeout(this.hide.bind(this),100)},pickerClicked:function(){if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=null}if(this.handlers.onClick){this.handlers.onClick()}},datePicked:function(a){this.element.value=Control.DatePicker.DateFormat.format(a,this.options.currentFormat);this.element.focus();this.hide();if(this.handlers.onSelect){this.handlers.onSelect(a)}if(this.element.onchange){this.element.onchange()}},dateHover:function(a){if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=null}if(this.pickerActive){this.element.value=Control.DatePicker.DateFormat.format(a,this.options.currentFormat);if(this.handlers.onHover){this.handlers.onHover(a)}}},toggle:function(a){if(this.pickerActive){this.element.value=this.originalValue;this.hide()}else{this.show()}Event.stop(a);return false},docKeyHandler:function(a){if(a.keyCode==Event.KEY_ESC){if(this.pickerActive){this.element.value=this.originalValue;this.hide()}}},keyHandler:function(a){switch(a.keyCode){case Event.KEY_ESC:if(this.pickerActive){this.element.value=this.originalValue}case Event.KEY_TAB:this.hide();return;case Event.KEY_DOWN:if(!this.pickerActive){this.show();Event.stop(a)}}if(this.pickerActive){return false}},hide:function(){if(this.pickerActive&&!this.element.disabled){this.datepicker.releaseKeys();Element.remove(this.datepicker.element);if(this.hidePickerListener){this.hidePickerListener.stop();this.hidePickerListener=null}this.pickerActive=false;Control.DatePicker.activePicker=null}},scrollOffset:function(b){var a=0,c=0;do{if(b.tagName=="BODY"){break}a+=b.scrollTop||0;c+=b.scrollLeft||0;b=b.parentNode}while(b);return Element._returnOffset(c,a)},show:function(){if(!this.pickerActive){if(Control.DatePicker.activePicker){Control.DatePicker.activePicker.hide()}this.element.focus();if(!this.datepicker){this.datepicker=new Control.DatePicker.Panel(this.options)}this.originalValue=this.element.value;var b=this.element.getLayout();var a=b.get("border-box-height")-b.get("border-bottom");this.element.parentNode.appendChild(this.datepicker.element);this.datepicker.element.clonePosition(this.element,{setWidth:false,setHeight:false,offsetTop:a});this.datepicker.element.style.zIndex="99";this.datepicker.selectDate(Control.DatePicker.DateFormat.parseFormat(this.element.value,this.options.currentFormat));this.datepicker.captureKeys();this.hidePickerListener=document.on("click",this.delayedHide.bindAsEventListener(this));this.pickerActive=true;Control.DatePicker.activePicker=this;this.pickerClicked()}}});Control.DatePicker.activePicker=null;Control.DatePicker.create=function(a){return new Control.DatePicker(a)};Control.DatePicker.i18n=Class.create();Object.extend(Control.DatePicker.i18n,{available:["pt_BR","nl_NL","fr_FR","lt_LT","pl_PL"],baseLocales:{us:{dateTimeFormat:"MM-dd-yyyy HH:mm",dateFormat:"MM-dd-yyyy",firstWeekDay:0,weekend:[0,6],timeFormat:"HH:mm"},eu:{dateTimeFormat:"dd-MM-yyyy HH:mm",dateFormat:"dd-MM-yyyy",firstWeekDay:1,weekend:[0,6],timeFormat:"HH:mm"},iso8601:{dateTimeFormat:"yyyy-MM-dd HH:mm",dateFormat:"yyyy-MM-dd",firstWeekDay:1,weekend:[0,6],timeFormat:"HH:mm"}},createLocale:function(a,b){return Object.extend(Object.clone(Control.DatePicker.i18n.baseLocales[a]),{language:b})}});Control.DatePicker.i18n.prototype={initialize:function(a){if(a){this.setLocale(a)}},setLocale:function(b){if(!(b in Control.DatePicker.Locale)&&Control.DatePicker.i18n.available.indexOf(b)>-1){throw ("Locale available but not loaded")}var c=b.charAt(2)=="_"?b.substring(0,2):b;var a=(Control.DatePicker.Locale[b]||Control.DatePicker.Locale[c]);this.opts=Object.clone(a||{});var d=a?Control.DatePicker.Language[a.language]:null;if(d){Object.extend(this.opts,d)}},opts:null,inheritOptions:function(a){if(!this.opts){this.setLocale("en_US")}return Object.extend(this.opts,a||{})},tr:function(a){return this.opts&&this.opts.strings?this.opts.strings[a]||a:a}};Control.DatePicker.Locale={};with(Control.DatePicker){Locale.es=i18n.createLocale("eu","es");Locale.en=i18n.createLocale("us","en");Locale.en_GB=i18n.createLocale("eu","en");Locale.en_AU=Locale.en_GB;Locale.de=i18n.createLocale("eu","de");Locale.es_iso8601=i18n.createLocale("iso8601","es");Locale.en_iso8601=i18n.createLocale("iso8601","en");Locale.de_iso8601=i18n.createLocale("iso8601","de")}Control.DatePicker.Language={es:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Augosto","Septiembre","Octubre","Novimbre","Diciembre"],days:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],strings:{Now:"Ahora",Today:"Hoy",Time:"Hora","Exact minutes":"Minuto exacto","Select Date and Time":"Selecciona Dia y Hora","Select Time":"Selecciona Hora","Open calendar":"Abre calendario"}},de:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],days:["So","Mo","Di","Mi","Do","Fr","Sa"],strings:{Now:"Jetzt",Today:"Heute",Time:"Zeit","Exact minutes":"Exakte minuten","Select Date and Time":"Zeit und Datum Auswählen","Select Time":"Zeit Auswählen","Open calendar":"Kalender öffnen"}}};Control.DatePicker.Panel=Class.create({initialize:function(options){try{this.i18n=new Control.DatePicker.i18n(options&&options.locale?options.locale:"en_US");options=this.i18n.inheritOptions(options)}catch(e){this.i18n=new Control.DatePicker.i18n()}this.options=Object.extend({className:"datepickerControl",closeOnToday:true,selectToday:true,datePicker:true,timePicker:false,use24hrs:false,firstWeekDay:0,weekend:[0,6],months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Su","Mo","Tu","We","Th","Fr","Sa"]},options||{});with(this.options){if(isNaN(firstWeekDay*1)){firstWeekDay=0}else{firstWeekDay=firstWeekDay%7}}this.keysCaptured=false;this.calendarCont=null;this.currentDate=this.options.date?this.options.date:new Date();this.dayOfWeek=0;this.minInterval=5;this.selectedDay=null;this.selectedHour=null;this.selectedMinute=null;this.selectedAmPm=null;this.currentDays=[];this.hourCells=[];this.minuteCells=[];this.otherMinutes=null;this.amCell=null;this.pmCell=null;this.element=this.createPicker();this.selectDate(this.currentDate)},createPicker:function(){var a=document.createElement("div");a.style.position="absolute";a.className=this.options.className;this.calendarCont=this.drawCalendar(a,this.currentDate);Event.observe(a,"click",this.clickHandler.bindAsEventListener(this));Event.observe(a,"dblclick",this.dblClickHandler.bindAsEventListener(this));this.documentKeyListener=this.keyHandler.bindAsEventListener(this);if(this.options.captureKeys){this.captureKeys()}return a},tr:function(a){return this.i18n.tr(a)},captureKeys:function(){Event.observe(document,"keydown",this.documentKeyListener,true);this.keysCaptured=true},releaseKeys:function(){Event.stopObserving(document,"keydown",this.documentKeyListener,true);this.keysCaptured=false},setDate:function(a){if(a){while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}this.calendarCont=this.drawCalendar(this.element,a)}},drawCalendar:function(a,d){var l=a;if(!this.options.datePicker){var n=document.createElement("table");n.cellSpacing=0;n.cellPadding=0;n.border=0}else{var n=this.createCalendar(d)}var m=this.options.use24hrs?6:7;if(this.options.timePicker){var e;if(this.options.timePickerAdjacent&&this.options.datePicker){var q=0;var b=document.createElement("table");b.cellSpacing=0;b.cellPadding=0;b.border=0;row=b.insertRow(0);cell=row.insertCell(0);cell.vAlign="top";cell.appendChild(n);l=cell;cell=row.insertCell(1);cell.style.width="5px";cell=row.insertCell(2);cell.vAlign="top";e=document.createElement("table");e.cellSpacing=0;e.cellPadding=0;e.border=0;cell.appendChild(e);a.appendChild(b);row=e.insertRow(q++);row.className="monthLabel";cell=row.insertCell(0);cell.colSpan=m;cell.innerHTML=this.tr("Time");row=e.insertRow(q++);cell=row.insertCell(0);cell.colSpan=m;cell.style.height="1px"}else{a.appendChild(n);e=n;var q=n.rows.length;if(this.options.datePicker){row=e.insertRow(q++);cell=row.insertCell(0);cell.colSpan=m;var p=document.createElement("hr");Element.setStyle(p,{color:"gray",backgroundColor:"gray",height:"1px",border:"0",marginTop:"3px",marginBottom:"3px",padding:"0"});cell.appendChild(p)}}var k=this.options.use24hrs?4:2;for(var g=0;g<k;++g){row=e.insertRow(q++);for(var h=0;h<6;++h){cell=row.insertCell(h);cell.className="hour";cell.width="14%";cell.innerHTML=(g*6)+h+(this.options.use24hrs?0:1);cell.onclick=this.hourClickedListener((g*6)+h+(this.options.use24hrs?0:1));this.hourCells[(g*6)+h]=cell}if(!this.options.use24hrs){cell=row.insertCell(h);cell.className="ampm";cell.width="14%";if(g){cell.innerHTML=this.tr("PM");cell.onclick=this.pmClickedListener();this.pmCell=cell}else{cell.innerHTML=this.tr("AM");cell.onclick=this.amClickedListener();this.amCell=cell}}}row=e.insertRow(q++);cell=row.insertCell(0);cell.colSpan=6;var p=document.createElement("hr");Element.setStyle(p,{color:"#CCCCCC",backgroundColor:"#CCCCCC",height:"1px",border:"0",marginTop:"2px",marginBottom:"2px",padding:"0"});cell.appendChild(p);cell=row.insertCell(1);for(var g=0;g<(10/this.minInterval);++g){row=e.insertRow(q++);for(var h=0;h<6;++h){cell=row.insertCell(h);cell.className="minute";cell.width="14%";var o=((g*6+h)*this.minInterval);if(o<10){o="0"+o}cell.innerHTML=":"+o;cell.onclick=this.minuteClickedListener(o);this.minuteCells[(g*6)+h]=cell}if(!this.options.use24hrs){cell=row.insertCell(h);cell.width="14%"}}row=e.insertRow(q++);cell=row.insertCell(0);cell.style.textAlign="right";cell.colSpan=5;cell.innerHTML="<i>"+this.tr("Exact minutes")+":</i>";cell=row.insertCell(1);cell.className="otherminute";var f=document.createElement("input");f.type="text";f.maxLength=2;f.style.width="2em";var c=null;f.onkeyup=function(i){if(!isNaN(f.value)){c=setTimeout(function(){this.currentDate.setMinutes(f.value);this.dateChanged(this.currentDate)}.bind(this),500)}}.bindAsEventListener(this);f.onkeydown=function(i){if(i.keyCode==Event.KEY_RETURN){if(this.options.onSelect){this.options.onSelect(this.currentDate)}}if(c){clearTimeout(c)}}.bindAsEventListener(this);f.onclick=f.select;f.onfocus=this.releaseKeys.bindAsEventListener(this);f.onblur=this.captureKeys.bindAsEventListener(this);this.otherMinutes=f;cell.appendChild(f);if(!this.options.use24hrs){cell=row.insertCell(2)}row=e.insertRow(q++);cell=row.insertCell(0);cell.colSpan=m;p=document.createElement("hr");Element.setStyle(p,{color:"gray",backgroundColor:"gray",height:"1px",border:"0",marginTop:"3px",marginBottom:"3px",padding:"0"});cell.appendChild(p);row=e.insertRow(q++);cell=row.insertCell(0);cell.colSpan=m;selectButton=document.createElement("input");selectButton.type="button";if(this.options.datePicker){selectButton.value=this.tr("Select Date and Time")}else{selectButton.value=this.tr("Select Time")}selectButton.onclick=function(i){this.options.onSelect&&this.options.onSelect(this.currentDate)}.bindAsEventListener(this);cell.appendChild(selectButton)}else{l.appendChild(n)}return l},createCalendar:function(d){this.currentDate=d;this.currentDays=[];var l=new Date();var b=new Date(d.getFullYear()-1,d.getMonth(),1);var a=new Date(d.getFullYear(),d.getMonth()-1,1);var h=new Date(d.getFullYear(),d.getMonth()+1,1);var n=new Date(d.getFullYear()+1,d.getMonth(),1);var q;var o;var p=0;var k=document.createElement("table");k.cellSpacing=0;k.cellPadding=0;k.border=0;q=k.insertRow(p++);q.className="monthLabel";o=q.insertCell(0);o.colSpan=7;o.innerHTML=this.monthName(d.getMonth())+" "+d.getFullYear();q=k.insertRow(p++);q.className="navigation";o=q.insertCell(0);o.className="navbutton";o.title=this.monthName(b.getMonth())+" "+b.getFullYear();o.onclick=this.movePreviousYearListener();o.innerHTML="&lt;&lt;";o=q.insertCell(1);o.className="navbutton";o.title=this.monthName(a.getMonth())+" "+a.getFullYear();o.onclick=this.movePreviousMonthListener();o.innerHTML="&lt;";o=q.insertCell(2);o.colSpan=3;o.className="navbutton";o.title=l.getDate()+" "+this.monthName(l.getMonth())+" "+l.getFullYear();o.onclick=this.dateClickedListener(l,true);if(this.options.timePicker){o.innerHTML=this.tr("Now")}else{o.innerHTML=this.tr("Today")}o=q.insertCell(3);o.className="navbutton";o.title=this.monthName(h.getMonth())+" "+h.getFullYear();o.onclick=this.moveNextMonthListener();o.innerHTML="&gt;";o=q.insertCell(4);o.className="navbutton";o.title=this.monthName(n.getMonth())+" "+n.getFullYear();o.onclick=this.moveNextYearListener();o.innerHTML="&gt;&gt;";q=k.insertRow(p++);q.className="dayLabel";for(var g=0;g<7;++g){o=q.insertCell(g);o.width="14%";o.innerHTML=this.dayName((this.options.firstWeekDay+g)%7)}q=null;var c=new Date(d.getFullYear(),d.getMonth(),1);var m=c.getDay();var f=0;if(m!=this.options.firstWeekDay){q=k.insertRow(p++);q.className="calendarRow";c.setDate(c.getDate()-((m-this.options.firstWeekDay+7)%7));m=c.getDay();while(c.getMonth()!=d.getMonth()){o=q.insertCell(q.cells.length);this.assignDayClasses(o,"dayothermonth",c);o.innerHTML=c.getDate();o.onclick=this.dateClickedListener(c);c.setDate(c.getDate()+1);m=c.getDay()}}while(c.getMonth()==d.getMonth()){if(m==this.options.firstWeekDay){q=k.insertRow(p++);q.className="calendarRow"}o=q.insertCell(q.cells.length);this.assignDayClasses(o,"day",c);o.innerHTML=c.getDate();o.onclick=this.dateClickedListener(c);this.currentDays[c.getDate()]=o;c.setDate(c.getDate()+1);m=c.getDay()}if(m!=this.options.firstWeekDay){do{o=q.insertCell(q.cells.length);this.assignDayClasses(o,"dayothermonth",c);o.innerHTML=c.getDate();var e=new Date(c.getTime());o.onclick=this.dateClickedListener(c);c.setDate(c.getDate()+1);m=c.getDay()}while(c.getDay()!=this.options.firstWeekDay)}return k},movePreviousMonthListener:function(){return function(a){var b=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()-1,this.currentDate.getDate(),this.currentDate.getHours(),this.currentDate.getMinutes());if(b.getMonth()!=(this.currentDate.getMonth()+11)%12){b.setDate(0)}this.selectDate(b)}.bindAsEventListener(this)},moveNextMonthListener:function(){return function(b){var a=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,this.currentDate.getDate(),this.currentDate.getHours(),this.currentDate.getMinutes());if(a.getMonth()!=(this.currentDate.getMonth()+1)%12){a.setDate(0)}this.selectDate(a)}.bindAsEventListener(this)},moveNextYearListener:function(){return function(a){var b=new Date(this.currentDate.getFullYear()+1,this.currentDate.getMonth(),this.currentDate.getDate(),this.currentDate.getHours(),this.currentDate.getMinutes());if(b.getMonth()!=this.currentDate.getMonth()){b.setDate(0)}this.selectDate(b)}.bindAsEventListener(this)},movePreviousYearListener:function(){return function(b){var a=new Date(this.currentDate.getFullYear()-1,this.currentDate.getMonth(),this.currentDate.getDate(),this.currentDate.getHours(),this.currentDate.getMinutes());if(a.getMonth()!=this.currentDate.getMonth()){a.setDate(0)}this.selectDate(a)}.bindAsEventListener(this)},dateClickedListener:function(a,b){var c=new Date(a.getTime());return function(d){if(!b){c.setHours(this.currentDate.getHours());c.setMinutes(this.currentDate.getMinutes())}this.dateClicked(c)}.bindAsEventListener(this)},hourClickedListener:function(a){return function(b){this.hourClicked(a)}.bindAsEventListener(this)},minuteClickedListener:function(a){return function(b){this.currentDate.setMinutes(a);this.dateClicked(this.currentDate)}.bindAsEventListener(this)},amClickedListener:function(){return function(a){if(this.selectedAmPm==this.pmCell){this.currentDate.setHours(this.currentDate.getHours()-12);this.dateClicked(this.currentDate)}}.bindAsEventListener(this)},pmClickedListener:function(){return function(a){if(this.selectedAmPm==this.amCell){this.currentDate.setHours(this.currentDate.getHours()+12);this.dateClicked(this.currentDate)}}.bindAsEventListener(this)},assignDayClasses:function(a,d,c){var b=new Date();Element.addClassName(a,d);if(c.getFullYear()==b.getFullYear()&&c.getMonth()==b.getMonth()&&c.getDate()==b.getDate()){Element.addClassName(a,"today")}if(this.options.weekend.include(c.getDay())){Element.addClassName(a,"weekend")}},monthName:function(a){return this.options.months[a]},dayName:function(a){return this.options.days[a]},dblClickHandler:function(a){if(this.options.onSelect){this.options.onSelect(this.currentDate)}Event.stop(a)},clickHandler:function(a){if(this.options.onClick){this.options.onClick()}Event.stop(a)},hoverHandler:function(a){if(this.options.onHover){this.options.onHover(date)}},keyHandler:function(c){var d=0;switch(c.keyCode){case Event.KEY_RETURN:if(this.options.onSelect){this.options.onSelect(this.currentDate)}break;case Event.KEY_LEFT:d=-1;break;case Event.KEY_UP:d=-7;break;case Event.KEY_RIGHT:d=1;break;case Event.KEY_DOWN:d=7;break;case 33:var b=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()-1,this.currentDate.getDate());d=-this.getDaysOfMonth(b);break;case 34:d=this.getDaysOfMonth(this.currentDate);break;case 13:this.dateClicked(this.currentDate);break;default:return}if(d!=0){var a=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),this.currentDate.getDate()+d);a.setHours(this.currentDate.getHours());a.setMinutes(this.currentDate.getMinutes());this.selectDate(a)}Event.stop(c);return false},getDaysOfMonth:function(a){var b=new Date(a.getFullYear(),a.getMonth()+1,0);return b.getDate()},getNextMonth:function(c,b,a){if(p_Month==11){return[0,b+1]}else{return[c+1,b]}},getPrevMonth:function(c,b,a){if(p_Month==0){return[11,b-1]}else{return[c-1,b]}},dateClicked:function(a){if(a){if(!this.options.timePicker&&this.options.onSelect){this.options.onSelect(a)}this.selectDate(a)}},dateChanged:function(a){if(a){if((!this.options.timePicker||!this.options.datePicker)&&this.options.onHover){this.options.onHover(a)}this.selectDate(a)}},hourClicked:function(a){if(!this.options.use24hrs){if(a==12){if(this.selectedAmPm==this.amCell){a=0}}else{if(this.selectedAmPm==this.pmCell){a+=12}}}this.currentDate.setHours(a);this.dateClicked(this.currentDate)},selectDate:function(b){if(b){if(this.options.datePicker){if(b.getMonth()!=this.currentDate.getMonth()||b.getFullYear()!=this.currentDate.getFullYear()){this.setDate(b)}else{this.currentDate=b}if(b.getDate()<this.currentDays.length){if(this.selectedDay){Element.removeClassName(this.selectedDay,"current")}this.selectedDay=this.currentDays[b.getDate()];Element.addClassName(this.selectedDay,"current")}}if(this.options.timePicker){var a=b.getHours();if(this.selectedHour){Element.removeClassName(this.selectedHour,"current")}if(this.options.use24hrs){this.selectedHour=this.hourCells[a]}else{this.selectedHour=this.hourCells[a%12?(a%12)-1:11]}Element.addClassName(this.selectedHour,"current");if(this.selectedAmPm){Element.removeClassName(this.selectedAmPm,"current")}this.selectedAmPm=(a<12?this.amCell:this.pmCell);Element.addClassName(this.selectedAmPm,"current");var c=b.getMinutes();if(this.selectedMinute){Element.removeClassName(this.selectedMinute,"current")}Element.removeClassName(this.otherMinutes,"current");if(c%this.minInterval==0){this.otherMinutes.value="";this.selectedMinute=this.minuteCells[c/this.minInterval];Element.addClassName(this.selectedMinute,"current")}else{this.otherMinutes.value=c;Element.addClassName(this.otherMinutes,"current")}}if(this.options.onHover){this.options.onHover(b)}}}});Control.DatePicker.DateFormat=Class.create({initialize:function(a){this.format=a},parse:function(a){return Control.DatePicker.DateFormat.parseFormat(a,this.format)},format:function(a){return Control.DatePicker.DateFormat.format(a,this.format)}});Object.extend(Control.DatePicker.DateFormat,{MONTH_NAMES:["January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],DAY_NAMES:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sun","Mon","Tue","Wed","Thu","Fri","Sat"],LZ:function(a){return(a<0||a>9?"":"0")+a},compareDates:function(e,f,c,d){var b=Control.DatePicker.DateFormat.parseFormat(e,f);var a=Control.DatePicker.DateFormat.parseFormat(c,d);if(b==0||a==0){return -1}else{if(b>a){return 1}}return 0},format:function(L,G){var P=Control.DatePicker.DateFormat.LZ;var l=Control.DatePicker.DateFormat.MONTH_NAMES;var x=Control.DatePicker.DateFormat.DAY_NAMES;G=G+"";var n="";var w=0;var J="";var f="";var j=L.getYear()+"";var g=L.getMonth()+1;var I=L.getDate();var p=L.getDay();var o=L.getHours();var A=L.getMinutes();var r=L.getSeconds();var u,v,b,t,N,e,F,D,B,q,Q,o,O,i,a,C;var z=new Object();if(j.length<4){j=""+(j-0+1900)}z.y=""+j;z.yyyy=j;z.yy=j.substring(2,4);z.M=g;z.MM=P(g);z.MMM=l[g-1];z.NNN=l[g+11];z.d=I;z.dd=P(I);z.E=x[p+7];z.EE=x[p];z.H=o;z.HH=P(o);if(o==0){z.h=12}else{if(o>12){z.h=o-12}else{z.h=o}}z.hh=P(z.h);if(o>11){z.K=o-12}else{z.K=o}z.k=o+1;z.KK=P(z.K);z.kk=P(z.k);if(o>11){z.a="PM"}else{z.a="AM"}z.m=A;z.mm=P(A);z.s=r;z.ss=P(r);while(w<G.length){J=G.charAt(w);f="";while((G.charAt(w)==J)&&(w<G.length)){f+=G.charAt(w++)}if(z[f]!=null){n+=z[f]}else{n+=f}}return n},_isInteger:function(c){var b="1234567890";for(var a=0;a<c.length;a++){if(b.indexOf(c.charAt(a))==-1){return false}}return true},_getInt:function(f,d,e,c){for(var a=c;a>=e;a--){var b=f.substring(d,d+a);if(b.length<e){return null}if(Control.DatePicker.DateFormat._isInteger(b)){return b}}return null},parseFormat:function(C,s){var B=Control.DatePicker.DateFormat.LZ;var j=Control.DatePicker.DateFormat.MONTH_NAMES;var n=Control.DatePicker.DateFormat.DAY_NAMES;var w=Control.DatePicker.DateFormat._getInt;C=C+"";s=s+"";var A=0;var m=0;var t="";var f="";var z="";var h,g;var b=new Date();var k=b.getYear();var v=b.getMonth()+1;var u=1;var d=b.getHours();var r=b.getMinutes();var p=b.getSeconds();var l="";while(m<s.length){t=s.charAt(m);f="";while((s.charAt(m)==t)&&(m<s.length)){f+=s.charAt(m++)}if(f=="yyyy"||f=="yy"||f=="y"){if(f=="yyyy"){h=4}g=4;if(f=="yy"){h=2}g=2;if(f=="y"){h=2}g=4;k=w(C,A,h,g);if(k==null){return 0}A+=k.length;if(k.length==2){if(k>70){k=1900+(k-0)}else{k=2000+(k-0)}}}else{if(f=="MMM"||f=="NNN"){v=0;for(var q=0;q<j.length;q++){var e=j[q];if(C.substring(A,A+e.length).toLowerCase()==e.toLowerCase()){if(f=="MMM"||(f=="NNN"&&q>11)){v=q+1;if(v>12){v-=12}A+=e.length;break}}}if((v<1)||(v>12)){return 0}}else{if(f=="EE"||f=="E"){for(var q=0;q<n.length;q++){var o=n[q];if(C.substring(A,A+o.length).toLowerCase()==o.toLowerCase()){A+=o.length;break}}}else{if(f=="MM"||f=="M"){v=w(C,A,f.length,2);if(v==null||(v<1)||(v>12)){return 0}A+=v.length}else{if(f=="dd"||f=="d"){u=w(C,A,f.length,2);if(u==null||(u<1)||(u>31)){return 0}A+=u.length}else{if(f=="hh"||f=="h"){d=w(C,A,f.length,2);if(d==null||(d<1)||(d>12)){return 0}A+=d.length}else{if(f=="HH"||f=="H"){d=w(C,A,f.length,2);if(d==null||(d<0)||(d>23)){return 0}A+=d.length}else{if(f=="KK"||f=="K"){d=w(C,A,f.length,2);if(d==null||(d<0)||(d>11)){return 0}A+=d.length}else{if(f=="kk"||f=="k"){d=w(C,A,f.length,2);if(d==null||(d<1)||(d>24)){return 0}A+=d.length;d--}else{if(f=="mm"||f=="m"){r=w(C,A,f.length,2);if(r==null||(r<0)||(r>59)){return 0}A+=r.length}else{if(f=="ss"||f=="s"){p=w(C,A,f.length,2);if(p==null||(p<0)||(p>59)){return 0}A+=p.length}else{if(f=="a"){if(C.substring(A,A+2).toLowerCase()=="am"){l="AM"}else{if(C.substring(A,A+2).toLowerCase()=="pm"){l="PM"}else{return 0}}A+=2}else{if(C.substring(A,A+f.length)!=f){return 0}else{A+=f.length}}}}}}}}}}}}}}if(A!=C.length){return 0}if(v==2){if(((k%4==0)&&(k%100!=0))||(k%400==0)){if(u>29){return 0}}else{if(u>28){return 0}}}if((v==4)||(v==6)||(v==9)||(v==11)){if(u>30){return 0}}if(d<12&&l=="PM"){d=d-0+12}else{if(d>11&&l=="AM"){d-=12}}var a=new Date(k,v-1,u,d,r,p);return a},parse:function(b,m){if(m){return Control.DatePicker.DateFormat.parseFormat(b,m)}else{var h=(arguments.length==2)?arguments[1]:false;var n=new Array("y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d");var c=new Array("M/d/y","M-d-y","M.d.y","MMM-d","M/d","M-d");var o=new Array("d/M/y","d-M-y","d.M.y","d-MMM","d/M","d-M");var a=[n,h?o:c,h?c:o];var k=null;for(var g=0;g<a.length;g++){var e=a[g];for(var f=0;f<e.length;f++){k=Control.DatePicker.DateFormat.parseFormat(b,e[f]);if(k!=0){return new Date(k)}}}return null}}});if(typeof Protoplasm!="undefined"){Protoplasm.register("datepicker",Control.DatePicker)};if(typeof Effect=="undefined"){if(typeof Protoplasm!="undefined"){Protoplasm.useScriptaculous("effects")}else{throw ("dialog.js requires including script.aculo.us' effects.js library")}}var Dialog={active:null};Dialog.Base=Class.create({baseInitialize:function(b,a){this.options=Object.extend({},a||{});this.createComponents();this.contents=$(b);this.dialog.appendChild(this.contents);this.keyListener=null},createComponents:function(){this.overlay=$("dialog_overlay");if(!this.overlay){this.overlay=new Element("div",{id:"dialog_overlay"});this.overlay.setStyle({position:"fixed",top:0,left:0,zIndex:90,width:"100%",height:"100%",backgroundColor:"#000",display:"none"});document.body.appendChild(this.overlay);if(!this.options.ignoreClicks){this.overlay.on("click",this.close.bind(this))}}this.dialog=$("dialog_box");if(!this.dialog){this.dialog=new Element("div",{id:"dialog_box"});this.dialog.setStyle({position:"fixed",display:"none",zIndex:91});if(this.options.width||this.options.height){this.dialog.style.overflow="auto";if(this.options.width){this.dialog.style.width=this.options.width+"px"}if(this.options.height){this.dialog.style.height=this.options.height+"px"}}if(this.options.dialogClass){this.dialog.addClassName(this.options.dialogClass)}document.body.appendChild(this.dialog)}},baseShow:function(){if(Dialog.active){Dialog.active.close()}Dialog.active=this;$$("select").invoke("hide");if(typeof Effect=="undefined"){this.overlay.show();this.dialog.show()}else{new Effect.Appear(this.overlay,{duration:0.1,from:0,to:0.3});new Effect.Appear(this.dialog,{duration:0.1})}this.resize();this.keyListener=document.on("keydown",function(a){if(!this.options.ignoreEsc&&a.keyCode==Event.KEY_ESC){this.close()}if(!(Event.findElement(a,"#dialog_box")||a.shiftKey||a.altKey||a.metaKey||a.ctrlKey)){Event.stop(a)}}.bind(this))},show:function(){this.baseShow()},resize:function(){var d=Element.getDimensions(this.dialog);var b=Element.getDimensions(this.contents);var c=document.viewport.getDimensions();this.dialog.style.left=((c.width-d.width)/2)+"px";if(d.height>(c.height-100)){var a=d.height-b.height;this.dialog.style.top="50px";this.dialog.style.height=(c.height-100)+"px";this.contents.style.height=(c.height-100-a)+"px";this.contents.style.overflow="auto"}else{this.dialog.style.top=((c.height-d.height)/2)*0.7+"px"}},close:function(){if(this.keyListener){this.keyListener.stop();this.keyListener=null}if(Dialog.active==this){Dialog.active=null}if(typeof Effect=="undefined"){this.overlay.hide();this.dialog.hide();$$("select").invoke("show");this.dialog.childElements().invoke("remove");if(this.options.onClose){this.options.onClose()}}else{new Effect.Fade(this.overlay,{duration:0.1});new Effect.Fade(this.dialog,{duration:0.1,afterFinish:function(){while(this.dialog.firstChild){this.dialog.firstChild.remove()}$$("select").invoke("show");if(this.options.onClose){this.options.onClose()}}.bind(this)})}},success:function(a){this.close();if(this.options.onSuccess){this.options.onSuccess(a,this.contents)}},failure:function(a){this.close();if(this.options.onFailure){this.options.onFailure(a,this.contents)}}});Dialog.HTML=Class.create(Dialog.Base,{initialize:function(b,a){this.baseInitialize(b,a)}});Dialog.Ajax=Class.create(Dialog.Base,{initialize:function(b,a){this.baseInitialize(new Element("div"),a);this.url=b},show:function(){var a='<div style="text-align: center; color: #999;">Loading...</div>';if(this.options.loadingIcon){a='<div style="text-align: center;"><img src="'+this.options.loadingIcon+'" /></div><br />'+a}this.contents.update(a);new Ajax.Updater(this.contents,this.url,{method:"get"});this.baseShow()}});if(window.Control==undefined){Control={}}Control.Expander=Class.create();Control.Expander.prototype={initialize:function(a,b){this._initialize(a,b)},_initialize:function(a,b){this.container=$(a);this.options=Object.extend({expandedClass:null,collapsedClass:null,hoverClass:null,triggerElement:null,onexpand:Prototype.emptyFunction,oncollapse:Prototype.emptyFunction},b||{});Element.cleanWhitespace(this.container);if(this.container.childNodes.length==2){this.title=this.container.childNodes[0];this.body=this.container.childNodes[1];this.trigger=this.options.triggerElement||this.title}if(!this.options.expand){this.collapse(true)}this.applyBehavior(this.trigger,this.body)},applyBehavior:function(b,a){b.onclick=function(c){if(this.expanded){this.collapse()}else{this.expand()}}.bindAsEventListener(this);b.onmouseover=this.hover.bindAsEventListener(this);b.onmouseout=this.restore.bindAsEventListener(this);b.onmousedown=function(c){return false}.bindAsEventListener(this);b.onselectstart=function(c){return false}.bindAsEventListener(this)},expand:function(){Element.removeClassName(this.title,this.options.collapsedClass);Element.addClassName(this.title,this.options.expandedClass);this.body.style.display="block";this.expanded=true;if(this.options.onexpand){this.options.onexpand(this)}},collapse:function(a){Element.removeClassName(this.title,this.options.expandedClass);Element.addClassName(this.title,this.options.collapsedClass);this.body.style.display="none";this.expanded=false;if(this.options.oncollapse&&!a){this.options.oncollapse(this)}},hover:function(){Element.addClassName(this.title,this.options.hoverClass)},restore:function(){Element.removeClassName(this.title,this.options.hoverClass)}};if(typeof Protoplasm!="undefined"){Protoplasm.register("expander",Control.Expander)};if(window.Control==undefined){Control={}}Control.FileChooser=Class.create();Control.FileChooser.prototype={initialize:function(b,c,a){this.element=$(b);if(fc=this.element.retrieve("filechooser")){fc.destroy()}this.options=a||{};if(window.Protoplasm!=undefined){var d=Protoplasm.base("filechooser");if(d){if(!this.options.icon){this.options.icon=d+"filechooser.png"}if(!this.options.fileImage){this.options.fileImage=d+"file.gif"}if(!this.options.directoryImage){this.options.directoryImage=d+"directory.gif"}if(!this.options.parentImage){this.options.parentImage=d+"parent.gif"}Protoplasm.loadStylesheet("filechooser.css","filechooser")}}if(this.options.icon){this.element.style.background="url("+this.options.icon+") right center no-repeat #FFF";this.oldPadding=this.element.style.paddingRight;this.element.style.paddingRight="20px"}this.filechooser=new Control.FileChooserPanel(c,Object.extend({openListener:this.fileSelected.bind(this),standalone:true,selectFile:this.element.value},this.options||{}));this.dialogOpen=false;this.dialog=this.filechooser.getElement();this.listeners=[this.element.on("click",this.toggleChooser.bindAsEventListener(this)),this.element.on("blur",this.delayedHide.bindAsEventListener(this)),this.dialog.on("click",this.cancelHide.bindAsEventListener(this)),this.element.on("keydown",this.hideChooser.bindAsEventListener(this))];this.clickListener=null;this.element.store("filechooser",this);this.destructor=Event.on(window,"unload",this.destroy.bind(this))},destroy:function(){this.hideChooser();for(var a=0;a<this.listeners.length;a++){this.listeners[a].stop()}if(this.clickListener){this.clickListener.stop()}this.element.style.paddingRight=this.oldPadding;this.element.store("filechooser",null);this.destructor.stop()},fileSelected:function(a){this.element.value=a.url;this.hideChooser()},toggleChooser:function(){if(this.dialogOpen){this.hideChooser()}else{this.showChooser()}},showChooser:function(){if(!this.dialogOpen){var c=Element.getDimensions(this.element);var a=Position.cumulativeOffset(this.element);var b=/MSIE/.test(navigator.userAgent)?(a[1]+c.height)+"px":(a[1]+c.height-1)+"px";this.dialog.style.top=b;this.dialog.style.left=a[0]+"px";if(this.element.value){this.filechooser.select(this.element.value)}else{this.filechooser.refresh()}document.body.appendChild(this.dialog);this.clickListener=document.on("click",this.documentClickHandler.bindAsEventListener(this));this.dialogOpen=true}},delayedHide:function(a){this.hideTimeout=setTimeout(this.hideChooser,100)},cancelHide:function(a){if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=null}},hideChooser:function(){if(this.dialogOpen){if(this.clickListener){this.clickListener.stop();this.clickListener=null}if(this.dialog.parentNode){Element.remove(this.dialog)}this.dialogOpen=false}},documentClickHandler:function(b){var a=Event.element(b);var c=false;do{if(a==this.dialog||a==this.element){c=true}}while(a=a.parentNode);if(!c){this.hideChooser()}}};Control.FileChooserPanel=Class.create();Control.FileChooserPanel.prototype={initialize:function(a,b){this.fileLister=a||Prototype.emptyFunction;this.options=Object.extend({width:360,height:220,className:"filechooserControl",fileImage:"/images/icons/file.gif",directoryImage:"/images/icons/directory.gif",parentImage:"/images/icons/parent.gif",uploadHandler:this.showUploadDialog.bindAsEventListener(this)},b||{});this.element=this.createFileChooser();if(this.options.selectFile){this.select(this.options.selectFile)}},getElement:function(){return this.element},createFileChooser:function(){var e=document.createElement("div");this.directoryHeader=document.createElement("div");this.directoryHeader.style.marginBottom="5px";this.directoryHeader.className="directoryheader";this.directoryHeader.innerHTML="&nbsp;";e.appendChild(this.directoryHeader);var k=document.createElement("table");k.cellSpacing=0;k.cellPadding=0;k.style.border=0;var l=k.insertRow(0);var f=this.options.height-40;var c=Math.round((this.options.width-6)*0.3);var d=this.options.height-61;var i=this.options.width-c-10;var j=l.insertCell(0);j.vAlign="top";this.fileList=document.createElement("div");Element.setStyle(this.fileList,{height:d+"px",width:i+"px",overflow:"auto",marginRight:"3px",marginBottom:"5px"});this.fileList.className="filelist";this.fileList.onmousedown=function(){return false};this.fileList.onselectstart=function(){return false};j.appendChild(this.fileList);this.createButton=document.createElement("input");this.createButton.type="button";this.createButton.value="New Folder";this.createButton.style.marginRight="5px";this.createButton.style.width=Math.round((i-10)/3)+"px";this.createButton.onclick=this.showDirectoryCreateDialog.bindAsEventListener(this);this.uploadButton=document.createElement("input");this.uploadButton.type="button";this.uploadButton.value="New File";this.uploadButton.style.marginRight="5px";this.uploadButton.style.width=Math.round((i-10)/3)+"px";this.uploadButton.onclick=function(m){this.options.uploadHandler(this)}.bindAsEventListener(this);this.deleteButton=document.createElement("input");this.deleteButton.type="button";this.deleteButton.value="Delete";this.deleteButton.style.width=Math.round((i-10)/3)+"px";this.deleteButton.onclick=this.showDeleteDialog.bindAsEventListener(this);var g=document.createElement("div");g.appendChild(this.createButton);g.appendChild(this.uploadButton);g.appendChild(this.deleteButton);j.appendChild(g);j=l.insertCell(1);j.vAlign="top";this.filePreview=document.createElement("div");Element.setStyle(this.filePreview,{height:f+"px",width:c+"px",marginLeft:"3px",marginBottom:"5px",overflow:"hidden",position:"relative"});this.filePreview.className="filepreview";j.appendChild(this.filePreview);e.appendChild(k);Event.observe(document,"keypress",this.keyPressListener());if(this.options.standalone){var b=document.createElement("form");b.style.margin=0;var k=document.createElement("table");k.cellSpacing=0;k.cellPadding=0;k.border=0;var l=k.insertRow(0);var j=l.insertCell(0);this.fileLocation=document.createElement("input");this.fileLocation.type="text";this.fileLocation.style.width="245px";this.fileLocation.style.marginRight="5px";this.fileLocation.readOnly=true;j.appendChild(this.fileLocation);j=l.insertCell(1);j.style.textAlign="right";var h=document.createElement("input");h.type="button";h.value="Cancel";h.style.width="50px";h.style.marginRight="5px";h.onclick=function(m){Element.remove(this.getElement())}.bindAsEventListener(this);j.appendChild(h);j=l.insertCell(2);j.style.textAlign="right";var h=document.createElement("input");h.type="button";h.value="Select";h.style.width="50px";h.onclick=function(m){(this.options.openListener||Prototype.emptyFunction)(this.selectedFile)}.bindAsEventListener(this);j.appendChild(h);b.appendChild(k);e.appendChild(b);var a=document.createElement("div");a.style.position="absolute";a.appendChild(e);a.className=this.options.className;return a}else{e.className=this.options.className;return e}},select:function(b){this.filePreview.innerHTML="";this.fileList.innerHTML='<div style="padding:3px">Loading file list...</div>';this.selectedFile=null;var a=this.fileLister(null,this.selectByURL(b).bind(this));if(a){this.selectByURL(b)(a)}},selectByURL:function(a){return function(b){if(b.status!="error"&&a&&a.indexOf(b.url)==0){var d=a.substr(b.url.length);var c=d.substr(0,d.lastIndexOf("/"));this.pendingSelect=a;if(c!=b.path){this.refresh(c);return}}this.populateFileList(b)}.bind(this)},refresh:function(a){if(!a&&this.currentDirectory){a=this.currentDirectory.path}if(this.prompt&&this.prompt.parentNode){Element.remove(this.prompt)}this.filePreview.innerHTML="";this.fileList.innerHTML='<div style="padding:3px">Loading file list...</div>';this.selectedFile=null;var b=this.fileLister(a,this.populateFileList.bind(this));if(b){this.populateFileList(b)}},populateFileList:function(b){if(b.status=="error"){this.refresh();return}this.currentDirectory=b;this.entries=[];this.directoryHeader.innerHTML="<b>Folder:</b> "+(b.path||"/");this.fileList.innerHTML="";if(b.parent){this.entries[this.entries.length]={image:"parent",type:"directory",name:"Parent folder",path:b.parent}}if(b.files){if(b.files.constructor==Array){b.files.each(function(i){this.entries.push(i)}.bind(this))}else{this.entries.push(b.files)}}if(this.entries.length){var g=document.createElement("table");var a=null;g.cellSpacing=0;g.cellPadding=0;g.width="100%";g.style.border=3;this.entries.each(function(j){var i=this.createFileRow(j,g);if(this.pendingSelect&&this.pendingSelect==j.url){this.selectRow(j);a=i;this.pendingSelect=null}}.bind(this));this.fileList.appendChild(g);if(a){var f=g.offsetHeight;var c=this.fileList.offsetHeight;var d=a.offsetTop;var e=d+a.offsetHeight;if(e>c){var h=Math.round(d-(c/2));if(h+c>f){this.fileList.scrollTop=f-c}else{this.fileList.scrollTop=h}}}}else{this.fileList.innerHTML='<div style="padding:3px">To add items to your folder, please click <b>New Folder</b> or <b>New File</b> below.</div>'}if(b.fileManager){this.createButton.disabled=false;if($("hidden_iframe")){this.uploadButton.disabled=false}else{this.uploadButton.disabled=true}}else{this.createButton.disabled=true;this.uploadButton.disabled=true}},showUploadDialog:function(){var a=document.createElement("div");a.className="prompt";a.style.position="absolute";a.onkeypress=function(l){if(l.stopPropagation){l.stopPropagation()}else{l.cancelBubble=true}}.bindAsEventListener(this);var b=$("hidden_iframe");var d=function(l){var m=b.contentWindow.document.body.innerHTML;if(a.parentNode){Element.remove(a)}if(m&&m!=""){alert(m)}else{this.refresh(this.currentDirectory.path)}}.bindAsEventListener(this);b.onload=d;var f=document.createElement("form");f.target=b.name;f.action=this.currentDirectory.fileManager;f.method="post";f.enctype="multipart/form-data";var c=document.createElement("input");c.type="hidden";c.name="a";c.value="upload";f.appendChild(c);c=document.createElement("input");c.type="hidden";c.name="p";c.value=(this.currentDirectory.path||"");f.appendChild(c);if(/MSIE/.test(navigator.userAgent)){f.encoding="multipart/form-data";f.onsubmit=function(l){var n;var m=function(){try{var o=b.contentWindow.document.readyState;if(o=="complete"){clearInterval(n);d()}}catch(p){}};n=setInterval(m,10)}.bindAsEventListener(this)}var i=document.createElement("table");var k=i.insertRow(0);var g=k.insertCell(0);g.colSpan=2;g.innerHTML="<b>Upload File</b>";k=i.insertRow(1);g=k.insertCell(0);g.innerHTML="File";g=k.insertCell(1);var e=document.createElement("input");e.type="file";e.name="i";e.style.width="200px";g.appendChild(e);k=i.insertRow(2);g=k.insertCell(0);g.innerHTML="New filename";g=k.insertCell(1);var e=document.createElement("input");e.type="text";e.name="n";e.style.width="200px";g.appendChild(e);var j=document.createElement("input");j.type="submit";j.value="Upload";j.style.marginRight="5px";var h=document.createElement("input");h.type="button";h.value="Cancel";h.onclick=function(l){Element.remove(a);Event.stop(l)};k=i.insertRow(3);g=k.insertCell(0);g.innerHTML="&nbsp;";g=k.insertCell(1);g.appendChild(j);g.appendChild(h);f.appendChild(i);a.appendChild(f);this.element.appendChild(a);this.prompt=a;a.style.top=Math.round((this.element.offsetHeight-a.offsetHeight)/2)+"px";a.style.left=Math.round((this.element.offsetWidth-a.offsetWidth)/2)+"px";Form.focusFirstElement(f)},showDeleteDialog:function(){var c=this.selectedFile.type=="directory"?"Are you sure you want to PERMANENTLY delete this folder\nand all files and folders in it?":"Are you sure you want to PERMANENTLY delete this file?";if(this.selectedFile&&confirm(c)){var b=this.currentDirectory.fileManager;var a={parameters:"a=delete&p="+(this.currentDirectory.path||"")+"&f="+this.selectedFile.name,onSuccess:function(d){this.refresh(this.currentDirectory.path)}.bindAsEventListener(this),onFailure:function(d){this.refresh(this.currentDirectory.path);alert(d.responseText)}.bindAsEventListener(this)};this.filePreview.innerHTML="";this.fileList.innerHTML="Loading file list...";new Ajax.Request(b,a)}},showDirectoryCreateDialog:function(){var a=prompt("Enter a folder name:","");if(a){this.createDirectory(a)}},createDirectory:function(c){var b=this.currentDirectory.fileManager;var a={parameters:"a=createdir&p="+(this.currentDirectory.path||"")+"&d="+c,onSuccess:this.createDirectorySuccessful.bind(this),onFailure:this.createDirectoryFailed.bind(this)};this.filePreview.innerHTML="";this.fileList.innerHTML="Loading file list...";new Ajax.Request(b,a)},createDirectorySuccessful:function(a){this.refresh(this.currentDirectory.path)},createDirectoryFailed:function(a){this.refresh(this.currentDirectory.path);alert(a.responseText)},showPreview:function(b){var c=document.createElement("img");var a=false;c.onload=function(i){if(!a){a=true;var k=c.width;var j=c.height;while(this.filePreview.firstChild){Element.remove(this.filePreview.firstChild)}var h=this.filePreview.offsetWidth-6;var g=this.filePreview.offsetHeight-6;var f=c.width/h;var d=c.height/g;if(f>1&&f>=d){c.width=Math.floor(c.width/f);c.height=Math.floor(c.height/f)}else{if(d>1){c.width=Math.floor(c.width/d);c.height=Math.floor(c.height/d)}}c.style.position="absolute";c.style.top=Math.round((g-c.height)/2)+"px";c.style.left=Math.round((h-c.width)/2)+"px";c.style.backgroundColor="#FFFFFF";c.border=1;this.filePreview.appendChild(c);if(this.options.previewListener){this.options.previewListener(k,j)}}}.bindAsEventListener(this);c.onerror=function(d){while(this.filePreview.firstChild){Element.remove(this.filePreview.firstChild)}if(this.options.previewListener){this.options.previewListener("","")}}.bindAsEventListener(this);c.src=b},createFileRow:function(b,d){var f=d.insertRow(d.rows.length);var a=f.insertCell(0);a.className="filerow";a.width=10;var c=document.createElement("img");c.src=this.options[(b.image||b.type)+"Image"];a.appendChild(c);a=f.insertCell(1);a.className="filerow";var g=document.createElement("div");g.style.overflow="hidden";g.innerHTML=b.name;a.appendChild(g);a=f.insertCell(2);a.className="filerow";a.align="right";if(b.size!==undefined){var e;if(b.type=="directory"){e=b.size+" items"}else{e=this.formatFileSize(b.size)}a.innerHTML="<nobr>"+e+"</nobr>"}else{a.innerHTML="&nbsp;"}f.onmousedown=this.fileSelectListener(b);if(b.type=="file"){f.ondblclick=this.fileOpenListener(b)}else{f.ondblclick=this.directoryOpenListener(b)}f.onselectstart=function(){return false};b.element=f;return f},formatFileSize:function(a){if(!a){a=0}if(a<1024){return a+" bytes"}else{if(a<1024*1024){return this.twoDecimals(a/1024)+" KB"}else{return this.twoDecimals(a/(1024*1024))+" MB"}}},twoDecimals:function(a){return Math.round(a*100)/100},fileSelectListener:function(a){return function(b){this.selectRow(a);return false}.bindAsEventListener(this)},directoryOpenListener:function(a){return function(b){this.refresh(a.path)}.bindAsEventListener(this)},fileOpenListener:function(a){return function(b){if(this.options.openListener){this.options.openListener(a)}}.bindAsEventListener(this)},keyPressListener:function(){return function(b){if(this.element.parentNode){switch(b.keyCode){case Event.KEY_DELETE:this.showDeleteDialog();break;case Event.KEY_RETURN:if(this.selectedFile.type=="file"){this.fileOpenListener(this.selectedFile)()}else{this.directoryOpenListener(this.selectedFile)()}break;case Event.KEY_UP:var a=this.selectedIndex()-1;if(a<0){a=0}this.selectRow(this.entries[a]);break;case Event.KEY_DOWN:var a=this.selectedIndex()+1;if(a>=this.entries.length){a=this.entries.length-1}this.selectRow(this.entries[a]);break;case 33:var c=Math.floor(this.fileList.offsetHeight/this.entries[0].element.offsetHeight);var a=this.selectedIndex()-c;if(a<0){a=0}this.selectRow(this.entries[a]);break;case 34:var c=Math.floor(this.fileList.offsetHeight/this.entries[0].element.offsetHeight);var a=this.selectedIndex()+c;if(a>=this.entries.length){a=this.entries.length-1}this.selectRow(this.entries[a]);break;case 35:if(this.entries){this.selectRow(this.entries[this.entries.length-1])}break;case 36:if(this.entries){this.selectRow(this.entries[0])}break;default:return}Event.stop(b)}}.bindAsEventListener(this)},selectRow:function(a){if(this.selectedFile!=a){if(this.selectedFile){Element.removeClassName(this.selectedFile.element,"selected")}this.selectedFile=a;Element.addClassName(a.element,"selected");if(a.url){this.showPreview(a.url);if(this.options.standalone){this.fileLocation.value=a.url}if(this.options.selectListener){this.options.selectListener(a.url)}}else{this.showPreview("");if(this.options.selectListener){this.options.selectListener("")}}}if(a.element.offsetTop<this.fileList.scrollTop){this.fileList.scrollTop=a.element.offsetTop}else{if(a.element.offsetTop+a.element.offsetHeight>this.fileList.scrollTop+this.fileList.offsetHeight){this.fileList.scrollTop=(a.element.offsetTop+a.element.offsetHeight)-this.fileList.offsetHeight}}},selectedIndex:function(){for(index=0;index<this.entries.length;++index){if(this.entries[index]==this.selectedFile){return index}}return -1}};if(typeof Protoplasm!="undefined"){Protoplasm.register("filechooser",Control.FileChooser)};if(window.Control==undefined){Control={}}Control.LiveGrid=Class.create();Control.LiveGrid.prototype={initialize:function(c,f,b,g,a){if(typeof Protoplasm!="undefined"){Protoplasm.loadStylesheet("livegrid.css","livegrid")}if(a==null){a={}}this.table=$(c);if(lg=this.table.retrieve("livegrid")){throw ("This table is already a Live Grid")}this.fetchHandler=g;this.sortField=a.sortField?a.sortField:null;this.sortDir=a.sortDir?a.sortDir:null;var d=this.table.rows[0].cells.length;this.metaData=new Control.LiveGrid.MetaData(f,b,d,a);this.buffer=new Control.LiveGrid.Buffer(this.metaData);this.viewPort=new Control.LiveGrid.ViewPort(this.table,this.buffer,this.metaData);this.scroller=new Control.LiveGrid.Scroller(this.viewPort,this.metaData,this.requestContentRefresh.bind(this));if(a.selectable){this.selector=new Control.LiveGrid.Selector(this.table,this.fetchHandler,this.metaData)}if(a.sortHeader){this.sorter=new Control.LiveGrid.Sort(a.sortHeader,this.metaData,this.sort.bind(this))}if(a.captureKeyEvents){this.captureKeys()}this.processingRequest=null;this.unprocessedRequest=null;if(a.prefetchBuffer||a.offset>0){var e=0;if(a.offset){e=a.offset;this.scroller.moveScroll(e);this.viewPort.scrollTo(this.scroller.rowToPixel(e))}this.requestContentRefresh(e)}this.table.store("livegrid",this)},resetContents:function(){this.scroller.unplug();this.scroller.moveScroll(0);this.scroller.plugin();this.buffer.clear();this.viewPort.clearContents()},captureKeys:function(){this.keyObserver=this.keyEvent.bindAsEventListener(this);Event.observe(window,"keypress",this.keyObserver)},releaseKeys:function(){Event.stopObserving(window,"keypress",this.keyObserver)},keyEvent:function(a){if(a.keyCode==Event.KEY_DOWN){this.moveSelection(a,1)}else{if(a.keyCode==Event.KEY_UP){this.moveSelection(a,-1)}else{if(a.keyCode==Event.KEY_RETURN&&a.shiftKey){this.selector.rowdblclickhandler()(a)}else{if(a.keyCode==33){this.moveSelection(a,-this.metaData.pageSize)}else{if(a.keyCode==34){this.moveSelection(a,this.metaData.pageSize)}}}}}},moveSelection:function(f,d){var g=this.metaData.totalRows-this.metaData.pageSize;if(g<0){g=0}if(this.selector){var b=(f.shiftKey&&this.selector.previousSelections!=null?this.selector.lastRangeSelected:this.selector.lastRowSelected);if(b==null){b=-1}if(b+d>=this.metaData.totalRows){d=(this.metaData.totalRows-b)-1}else{if(b+d<0){d=-b}}var c=this.selector.currentOffset;var a=b+d;if(a-c>=this.metaData.getPageSize()||a-c<0){var h=c+d;if(h>g){h=g;a=b+(g-h)}else{if(h<0){a=0;h=0}}this.scroller.moveScroll(h)}this.selector.rowmousedownhandler.bind(this.selector)(a-c)(f)}else{var c=parseInt(this.scroller.scrollerDiv.scrollTop/this.viewPort.rowHeight);var h=c+d;if(h>g){h=g}this.scroller.moveScroll(h)}},sort:function(b,a){this.sortField=b;this.sortDir=a;this.refresh()},refresh:function(){this.resetContents();this.requestContentRefresh(0);if(this.selector){this.selector.deselectAllRows()}},setTotalRows:function(a){this.metaData.setTotalRows(a);this.viewPort.setPageSize(this.metaData.getPageSize());this.scroller.updateSize();if(this.selector){this.selector.applyRowBehavior()}},handleTimedOut:function(){this.processingRequest=null;this.processQueuedRequest()},fetchBuffer:function(c){if(this.buffer.isInRange(c)&&!this.buffer.isNearingLimit(c)){return}if(this.processingRequest){this.unprocessedRequest=new Control.LiveGrid.Request(c);return}var b=this.buffer.getFetchOffset(c);this.processingRequest=new Control.LiveGrid.Request(c);this.processingRequest.bufferOffset=b;var a=this.buffer.getFetchSize(c);var d=false;this.fetchHandler(b,a,this.sortField,this.sortDir,this.updateData.bind(this));this.timeoutHandler=setTimeout(this.handleTimedOut.bind(this),20000)},requestContentRefresh:function(a){this.fetchBuffer(a)},updateData:function(a){try{clearTimeout(this.timeoutHandler);this.buffer.update(a,this.processingRequest.bufferOffset);this.viewPort.bufferChanged()}catch(b){}finally{this.processingRequest=null}this.processQueuedRequest()},processQueuedRequest:function(){if(this.unprocessedRequest!=null){this.requestContentRefresh(this.unprocessedRequest.requestOffset);this.unprocessedRequest=null}}};Control.LiveGrid.staticFetchHandler=function(c,b){var a=Control.LiveGrid.convertToLiveGridRows(c,b);return function(k,d,f,e,l){if(f){var h=-1;for(var g=0;g<b.length;++g){if(b[g]==f){h=g;break}}if(h>-1){a=a.sort(function(m,i){var n=m.columns[h];var o=i.columns[h];if(n<o){return(e.toLowerCase()=="desc"?1:-1)}else{if(n==o){return 0}else{if(n>o){return(e.toLowerCase()=="desc"?-1:1)}}}})}}if(k>=a.length){k=a.length-1}if(k+d>a.length){d=a.length-k}l(a.slice(k,k+d))}};Control.LiveGrid.convertToLiveGridRows=function(d,c){var e=Array();if(d.length){for(var b=0;b<d.length;++b){e[b]={id:d[b].id,columns:new Array()};for(var a=0;a<c.length;++a){e[b].columns[a]=d[b][c[a]]}}}else{e[0]={id:d.id,columns:new Array()};for(var a=0;a<c.length;++a){e[0].columns[a]=d[c[a]]}}return e};Control.LiveGrid.MetaData=Class.create();Control.LiveGrid.MetaData.prototype={initialize:function(a,c,d,b){this.pageSize=a;this.totalRows=c;this.setOptions(b);this.scrollArrowHeight=16;this.columnCount=d},setOptions:function(a){this.options=Object.extend({largeBufferSize:7,nearLimitFactor:0.2},a||{})},getPageSize:function(){return this.totalRows<this.pageSize?this.totalRows:this.pageSize},getTotalRows:function(){return this.totalRows},setTotalRows:function(a){this.totalRows=a},getLargeBufferSize:function(){return parseInt(this.options.largeBufferSize*this.pageSize)},getLimitTolerance:function(){return parseInt(this.getLargeBufferSize()*this.options.nearLimitFactor)}};Control.LiveGrid.Scroller=Class.create();Control.LiveGrid.Scroller.prototype={initialize:function(b,a,c){this.metaData=a;this.viewPort=b;this.scrollHandler=c;this.isIE=navigator.userAgent.toLowerCase().indexOf("msie")>=0;this.createScrollBar();this.scrollTimeout=null;this.rows=new Array()},isUnPlugged:function(){return this.scrollerDiv.onscroll==null},plugin:function(){this.scrollerDiv.onscroll=this.handleScroll.bindAsEventListener(this)},unplug:function(){this.scrollerDiv.onscroll=null},createScrollBar:function(){var a=this.viewPort.visibleHeight();this.scrollerDiv=document.createElement("div");var b=this.scrollerDiv.style;b.position="relative";b.left=this.isIE?"-6px":"-3px";b.width="19px";b.height=a+"px";b.overflow="auto";this.heightDiv=document.createElement("div");this.heightDiv.style.width="1px";this.heightDiv.style.height=parseInt(a*this.metaData.getTotalRows()/this.metaData.getPageSize())+"px";this.scrollerDiv.appendChild(this.heightDiv);var c=this.viewPort.table;c.parentNode.parentNode.insertBefore(this.scrollerDiv,c.parentNode.nextSibling);setTimeout(this.plugin.bind(this))},updateSize:function(){var b=this.viewPort.table;var a=this.viewPort.visibleHeight();this.scrollerDiv.style.height=a+"px";if(this.metaData.getPageSize()==0){this.heightDiv.style.height=0}else{this.heightDiv.style.height=parseInt(a*this.metaData.getTotalRows()/this.metaData.getPageSize())+"px"}},rowToPixel:function(a){return(a/this.metaData.getTotalRows())*this.heightDiv.offsetHeight},moveScroll:function(a){var b=this.metaData.totalRows==0?0:a;if(this.metaData.options.onbeforescroll){this.metaData.options.onbeforescroll(a,this.metaData.getPageSize(),this.metaData.totalRows)}this.scrollerDiv.scrollTop=this.rowToPixel(a);if(this.metaData.options.onscroll){this.metaData.options.onscroll(a,this.metaData.getPageSize(),this.metaData.totalRows)}},handleScroll:function(){if(this.scrollTimeout){clearTimeout(this.scrollTimeout)}var a=parseInt(this.scrollerDiv.scrollTop/this.viewPort.rowHeight);if(this.metaData.options.onbeforescroll){this.metaData.options.onbeforescroll(a,this.metaData.getPageSize(),this.metaData.totalRows)}this.scrollHandler(a);this.viewPort.scrollTo(this.scrollerDiv.scrollTop);if(this.metaData.options.onscroll){this.metaData.options.onscroll(a,this.metaData.getPageSize(),this.metaData.totalRows)}this.scrollTimeout=setTimeout(this.scrollIdle.bind(this),1200)},scrollIdle:function(){if(this.metaData.options.onscrollidle){this.metaData.options.onscrollidle()}}};Control.LiveGrid.Buffer=Class.create();Control.LiveGrid.Buffer.prototype={initialize:function(a,b){this.startPos=0;this.size=0;this.metaData=a;this.rows=new Array();this.updateInProgress=false;this.viewPort=b;this.maxBufferSize=a.getLargeBufferSize()*2;this.maxFetchSize=a.getLargeBufferSize();this.lastOffset=0},getBlankRow:function(){if(!this.blankRow){this.blankRow=new Array();for(var a=0;a<this.metaData.columnCount;a++){this.blankRow[a]="&nbsp;"}}return this.blankRow},fixRows:function(a){for(var c=0;c<a.length;++c){for(var b=0;b<a[c].columns.length;++b){if(!a[c].columns[b]){a[c].columns[b]="&nbsp;"}}}return a},update:function(a,d){var b=this.fixRows(a);if(this.rows.length==0){this.rows=b;this.size=this.rows.length;this.startPos=d;return}if(d>this.startPos){if(this.startPos+this.rows.length<d){this.rows=b;this.startPos=d}else{this.rows=this.rows.concat(b.slice(0,b.length));if(this.rows.length>this.maxBufferSize){var c=this.rows.length;this.rows=this.rows.slice(this.rows.length-this.maxBufferSize,this.rows.length);this.startPos=this.startPos+(c-this.rows.length)}}}else{if(d+b.length<this.startPos){this.rows=b}else{this.rows=b.slice(0,this.startPos).concat(this.rows);if(this.rows.length>this.maxBufferSize){this.rows=this.rows.slice(0,this.maxBufferSize)}}this.startPos=d}this.size=this.rows.length},clear:function(){this.rows=new Array();this.startPos=0;this.size=0},isOverlapping:function(b,a){return((b<this.endPos())&&(this.startPos<b+a))||(this.endPos()==0)},isInRange:function(a){return(a>=this.startPos)&&(a+this.metaData.getPageSize()<=this.endPos())},isNearingTopLimit:function(a){return a-this.startPos<this.metaData.getLimitTolerance()},endPos:function(){return this.startPos+this.rows.length},isNearingBottomLimit:function(a){return this.endPos()-(a+this.metaData.getPageSize())<this.metaData.getLimitTolerance()},isAtTop:function(){return this.startPos==0},isAtBottom:function(){return this.endPos()==this.metaData.getTotalRows()},isNearingLimit:function(a){return(!this.isAtTop()&&this.isNearingTopLimit(a))||(!this.isAtBottom()&&this.isNearingBottomLimit(a))},getFetchSize:function(c){var a=this.getFetchOffset(c);var b=0;if(a>=this.startPos){var d=this.maxFetchSize+a;if(d>this.metaData.totalRows){d=this.metaData.totalRows}b=d-a}else{var b=this.startPos-a;if(b>this.maxFetchSize){b=this.maxFetchSize}}return b},getFetchOffset:function(b){var a=b;if(b>this.startPos){a=(b>this.endPos())?b:this.endPos()}else{if(b+this.maxFetchSize>=this.startPos){var a=this.startPos-this.maxFetchSize;if(a<0){a=0}}}this.lastOffset=a;return a},getRows:function(g,e){var f=g-this.startPos;var b=f+e;if(b>this.size){b=this.size}var d=new Array();var a=0;for(var c=f;c<b;c++){d[a++]=this.rows[c]}return d},convertSpaces:function(a){return a.split(" ").join("&nbsp;")}};Control.LiveGrid.ViewPort=Class.create();Control.LiveGrid.ViewPort.prototype={initialize:function(c,b,a){this.metaData=a;this.table=c;this.buffer=b;this.setPageSize(a.getPageSize());this.rowTemplate=null;this.lastDisplayedStartPos=0;this.lastPixelOffset=0;this.startPos=0},setPageSize:function(a){this.fillTableRows(this.table,a);this.div=this.table.parentNode;this.rowHeight=a>0?this.table.offsetHeight/a:1;this.div.style.height=this.table.offsetHeight+"px";this.div.style.overflow="hidden";this.visibleRows=a>0?a+1:0;this.fillTableRows(this.table,this.visibleRows);this.setOddOrEven(this.table,0)},fillTableRows:function(d,e){if(d.rows.length||this.rowTemplate){if(!this.rowTemplate){this.rowTemplate=d.rows[0];for(var c=0;c<this.rowTemplate.cells.length;++c){if(!this.rowTemplate.cells[c].innerHTML){this.rowTemplate.cells[c].innerHTML="&nbsp;"}}}while(d.rows.length<e){var b=d.insertRow(d.rows.length);b.className=this.rowTemplate.className;for(j=0;j<this.rowTemplate.cells.length;++j){var a=b.insertCell(b.cells.length);if(this.rowTemplate.cells[j].className){a.className=this.rowTemplate.cells[j].className}if(this.rowTemplate.cells[j].width){a.width=this.rowTemplate.cells[j].width}if(this.rowTemplate.cells[j].style.width){a.style.width=this.rowTemplate.cells[j].style.width}a.innerHTML="&nbsp;"}}while(d.rows.length>e){d.deleteRow(d.rows.length-1)}}},setOddOrEven:function(b,c){for(var a=0;a<b.rows.length;++a){if(a%2==1){Element.removeClassName(b.rows[a],"even");Element.addClassName(b.rows[a],"odd")}else{Element.removeClassName(b.rows[a],"odd");Element.addClassName(b.rows[a],"even")}}},populateRow:function(e,d){var a=e.cells.length;var c=d.columns?d.columns:d;if(d.id){e.id=this.metaData.options.rowIdPrefix?this.metaData.options.rowIdPrefix+d.id:d.id}for(var b=0;b<a;b++){e.cells[b].innerHTML=c[b]}},bufferChanged:function(){this.refreshContents(parseInt(this.lastPixelOffset/this.rowHeight))},clearRows:function(){if(!this.isBlank){for(var a=0;a<this.visibleRows;a++){this.populateRow(this.table.rows[a],this.buffer.getBlankRow())}this.isBlank=true}},clearContents:function(){this.clearRows();this.scrollTo(0);this.startPos=0;this.lastStartPos=-1},refreshContents:function(g){if(g==this.lastRowPos&&!this.isPartialBlank&&!this.isBlank){return}if((g+this.visibleRows<this.buffer.startPos)||(this.buffer.startPos+this.buffer.size<g)||(this.buffer.size==0)){this.clearRows();return}this.isBlank=false;var f=this.buffer.startPos>g;var b=f?this.buffer.startPos:g;var a=(this.buffer.startPos+this.buffer.size<g+this.visibleRows)?this.buffer.startPos+this.buffer.size:g+this.visibleRows;var k=a-b;var l=this.buffer.getRows(b,k);var d=this.visibleRows-k;var h=f?0:k;var c=f?d:0;for(var e=0;e<l.length;e++){this.populateRow(this.table.rows[e+c],l[e])}for(var e=0;e<d;e++){this.populateRow(this.table.rows[e+h],this.buffer.getBlankRow())}this.isPartialBlank=d>0;this.lastRowPos=g},scrollTo:function(a){if(this.lastPixelOffset==a){return}this.refreshContents(parseInt(a/this.rowHeight));this.div.scrollTop=a%this.rowHeight;this.lastPixelOffset=a},visibleHeight:function(){return parseInt(this.div.style.height)}};Control.LiveGrid.Request=Class.create();Control.LiveGrid.Request.prototype={initialize:function(b,a){this.requestOffset=b}};Control.LiveGrid.Selector=Class.create();Control.LiveGrid.Selector.prototype={initialize:function(b,c,a){this.table=b;this.fetchHandler=c;this.metaData=a;this.lastRowSelected=null;this.lastRangeSelected=null;this.rowIdPrefix=(a.options.rowIdPrefix?a.options.rowIdPrefix:"");this.selectedClass=(a.options.selectedClass?a.options.selectedClass:"selected");this.onrowselect=a.options.onrowselect;this.onrowopen=a.options.onrowopen;this.currentOffset=a.options.offset?a.options.offset:0;a.options.onbeforescroll=this.handleScroll.bind(this);this.selections=Array();this.previousSelections=Array();this.applyRowBehavior()},applyRowBehavior:function(){for(var a=0;a<this.table.rows.length;++a){this.table.rows[a].onmousedown=this.rowmousedownhandler(a);this.table.rows[a].onmousemove=this.rowmousemovehandler(a);this.table.rows[a].onmouseup=this.rowmouseuphandler();this.table.rows[a].ondblclick=this.rowdblclickhandler();this.table.rows[a].onselectstart=function(){return false}}},rowmousedownhandler:function(a){return function(b){this.dragging=true;this.onrowclick(a,b);if(this.onrowselect){this.onrowselect(b,this)}Event.stop(b);return false}.bindAsEventListener(this)},rowmousemovehandler:function(a){return function(b){if(this.dragging){this.onrowclick(a,b,true);if(this.onrowselect){this.onrowselect(b,this)}}return false}.bindAsEventListener(this)},rowmouseuphandler:function(a){return function(b){this.dragging=false}.bindAsEventListener(this)},rowdblclickhandler:function(){return function(a){if(this.onrowopen){this.onrowopen(a,this)}Event.stop(a)}.bindAsEventListener(this)},onrowclick:function(b,f,a){var d=this.table.rows[b].id;var g=this.currentOffset+b;if(f.shiftKey||a){if(!this.previousSelections){this.previousSelections=this.copyArray(this.selections)}else{this.selections=this.copyArray(this.previousSelections)}if(this.lastRowSelected<g){for(var c=this.lastRowSelected;c<=g;++c){this.selections[c]=this.table.rows[c-this.currentOffset].id}}else{if(this.lastRowSelected>g){for(var c=this.lastRowSelected;c>=g;--c){this.selections[c]=this.table.rows[c-this.currentOffset].id}}}this.lastRangeSelected=g}else{if(f.ctrlKey){this.selections[g]=this.selections[g]?null:d;this.lastRowSelected=g;this.previousSelections=null}else{this.deselectAllRows(true);this.selections[g]=d;this.lastRowSelected=g;this.previousSelections=null}}this.redrawSelections()},copyArray:function(a){var b=new Array(a.length);for(var c=0;c<a.length;++c){b[c]=a[c]}return b},selectedRows:function(){var b=new Array();var c=(this.rowIdPrefix?this.rowIdPrefix.length:0);for(var a=0;a<this.selections.length;++a){if(this.selections[a]){b[b.length]=this.selections[a].substring(c)}}return b},handleScroll:function(c,a,b){this.currentOffset=c;this.redrawSelections()},selectAllRows:function(){alert("Not implemented");if(this.onrowselect){this.onrowselect(null,this)}},deselectAllRows:function(a){this.selections=new Array();this.redrawSelections();this.lastRowSelected=null;this.previousSelections=null;if(this.onrowselect){this.onrowselect(null,this)}},redrawSelections:function(b){b=b?b:this.currentOffset;for(var a=0;a<this.table.rows.length;++a){if(b+a<this.metaData.totalRows){if(this.selections[b+a]){Element.addClassName(this.table.rows[a],this.selectedClass)}else{Element.removeClassName(this.table.rows[a],this.selectedClass)}}}}};Control.LiveGrid.Sort=Class.create();Control.LiveGrid.Sort.prototype={initialize:function(c,b,a){this.table=$(c);this.sortHandler=a;this.setOptions(b.options);this.columns=this.table.rows[0].cells;this.applySortBehavior(this.columns);this.initSortColumn()},initSortColumn:function(){var a=this.options.sortField;if(a){var c=this.options.sortDirection?this.options.sortDirection:"asc";for(var b=0;b<this.columns.length;++b){if(this.columns[b].getAttribute("sortField")==a){this.setSortColumn(this.columns[b],c)}}}},setOptions:function(a){var c={sortAscendImg:"images/sort_asc.png",sortDescendImg:"images/sort_desc.png",imageWidth:9,imageHeight:5};if(typeof Protoplasm!="undefined"){var b=Protoplasm.base("livegrid");c.sortAscendImg=b+"sort_asc.png";c.sortDescendImg=b+"sort_desc.png"}this.options=Object.extend(c,a);new Image().src=this.options.sortAscendImg;new Image().src=this.options.sortDescendImg},applySortBehavior:function(a){for(var b=0;b<a.length;++b){if(this.isSortable(b)){var c=this.options.sortFields?this.options.sortFields[b]:a[b].id;a[b].setAttribute("sortField",c);a[b].style.cursor="pointer";a[b].onclick=this.onclick.bindAsEventListener(this);a[b].innerHTML+='<span id="'+c+'_img">&nbsp;&nbsp;&nbsp;</span>'}}},isSortable:function(a){return(!this.options.sortFields||this.options.sortFields[a])},onclick:function(b){var a=Event.element(b);while(a.tagName.toUpperCase()!="TD"&&a.tagName.toUpperCase()!="TH"){a=a.parentNode}this.setSortColumn(a);this.executeSort()},setSortColumn:function(a,b){if(a.getAttribute("sortField")==this.sortField){this.sortDirection=(this.sortDirection=="asc"?"desc":"asc")}else{this.sortField=a.getAttribute("sortField");this.sortDirection="asc"}this.refreshColumnDisplay()},refreshColumnDisplay:function(){for(var a=0;a<this.columns.length;++a){if(this.columns[a].onclick){var b=$(this.columns[a].getAttribute("sortField")+"_img");if(this.columns[a].getAttribute("sortField")==this.sortField){if(this.sortDirection=="asc"){b.innerHTML='&nbsp;&nbsp;<img width="'+this.options.imageWidth+'" height="'+this.options.imageHeight+'" src="'+this.options.sortAscendImg+'"/>'}else{if(this.sortDirection=="desc"){b.innerHTML='&nbsp;&nbsp;<img width="'+this.options.imageWidth+'" height="'+this.options.imageHeight+'" src="'+this.options.sortDescendImg+'"/>'}else{b.innerHTML="&nbsp;&nbsp;"}}}else{b.innerHTML="&nbsp;&nbsp;"}}}},executeSort:function(){this.sortHandler(this.sortField,this.sortDirection)}};if(typeof Protoplasm!="undefined"){Protoplasm.register("livegrid",Control.LiveGrid)};if(window.Control==undefined){Control={}}Control.RatingBar=Class.create();Control.RatingBar.prototype={initialize:function(b,a){if(typeof Protoplasm!="undefined"){Protoplasm.loadStylesheet("rating.css","ratingbar")}this.element=$(b);this.stars=[];this.options=Object.extend({min:1,max:5,rating:0,starClass:"rating_star",onClass:"rating_on",halfClass:"rating_half",hoverClass:"rating_hover",waitForUpdate:false,onclick:Prototype.K,onhover:Prototype.K},a||{});this.rating=this.options.rating;this.loading=document.createElement("div");this.loading.className="rating_loading";this.animating=false;this.createRatingBar();this.element.onmouseout=function(){if(!this.animating){this.resetRating()}}.bind(this)},createRatingBar:function(){this.element.cleanWhitespace();this.element.style.height="20px";if(this.element.childNodes.length==1&&this.element.firstChild.nodeType==3){this.rating=this.element.firstChild.nodeValue;this.element.removeChild(this.element.firstChild)}if(!this.element.childNodes.length){for(var a=this.options.min;a<=this.options.max;++a){var b=document.createElement("div");b.addClassName(this.options.starClass);this.element.appendChild(b)}}else{this.rating=this.options.min;for(var a=1;a<this.element.childNodes.length;++a){var c=$(this.element.childNodes[a]);if(c.hasClassName(this.options.onClass)){this.rating++}else{if(c.hasClassName(this.options.halfClass)){this.rating+=0.5}}}}for(var a=0;a<this.element.childNodes.length;++a){var c=$(this.element.childNodes[a]);if(c.hasClassName(this.options.starClass)){this.setStarBehavior(c,a+this.options.min);this.stars.push(c)}}if(this.options.rating){this.rating=this.options.rating}if(this.rating){this.showRating(this.rating)}},setStarBehavior:function(b,a){b.onmouseover=this.hoverRating.bind(this,a);b.onclick=this.doRating.bind(this,a)},hoverRating:function(b){b=Math.ceil(b);for(var a=0;a<this.stars.length;++a){this.stars[a].className=this.options.starClass;var c=a+this.options.min;if(c<=b){this.stars[a].addClassName(this.options.hoverClass)}}if(this.options.onhover){this.options.onhover(this)}},doRating:function(a){this.rating=a;this.animateBar(a,1,150,this.resetRating.bind(this));if(this.options.onclick){this.options.onclick(this)}},animateBar:function(d,f,c,a,e,b){this.animating=true;if(!e){e=0}if(e<f){if(b){this.hoverRating(d);e++}else{this.showRating(d)}setTimeout(this.animateBar.bind(this,d,f,c,a,e,!b),c)}else{if(e>=f){setTimeout(function(){this.animating=false;a()}.bind(this),500)}}},showRating:function(b){for(var a=0;a<this.stars.length;++a){this.stars[a].className=this.options.starClass;var c=a+this.options.min;if(c<=b){this.stars[a].addClassName(this.options.onClass)}else{if(c-0.5<=b){this.stars[a].addClassName(this.options.halfClass)}}}},resetRating:function(){if(!this.animating){this.showRating(this.rating);if(this.options.input){$(this.options.input).value=this.rating}}},setLoading:function(a){if(a){if(!this.loading.parentNode){this.element.appendChild(this.loading)}}else{$(this.loading).remove()}}};if(typeof Protoplasm!="undefined"){Protoplasm.register("ratingbar",Control.RatingBar)};if(typeof Control=="undefined"){Control={}}if(typeof Protoplasm!="undefined"){Protoplasm.use("colorpicker")}else{if(typeof Control.ColorPicker.Panel=="undefined"){throw ("RTE requires the colorpicker control")}}Control.RTE=Class.create();Object.extend(Control.RTE,{activeEditor:null,useEffects:false,dialogElement:null,includePath:null,initialized:false,editors:{},init:function(){if(!Control.RTE.initialized){Control.RTE.Dialog.cache={ColorPalette:new Control.RTE.Dialog.ColorPalette(),InsertLink:new Control.RTE.Dialog.InsertLink(),ImageBrowser:new Control.RTE.Dialog.ImageBrowser(),InsertTable:new Control.RTE.Dialog.InsertTable()};if(typeof Protoplasm!="undefined"){Protoplasm.loadStylesheet("rte.css","rte")}}},createElement:function(d,a,c,f){var b=null;try{b=document.createElement(d);if(a){for(att in a){b.setAttribute(att,a[att])}}if(c){b.className=c}if(f){Element.setStyle(b,f)}}catch(g){alert("Could not create element.")}return b}});Control.RTE.prototype={initialize:function(a,b){if(!Control.RTE.initialized){Control.RTE.init()}this.textarea=$(a);if(ta=this.textarea.retrieve("editor")){ta.destroy()}this.options=b||{};if(this.options.includePath){if(!/\/$/.test(includePath)){includePath+="/"}Control.RTE.includePath=includePath||""}else{if(typeof Protoplasm!="undefined"){Control.RTE.includePath=Protoplasm.base("rte")+"images/"}}this.toolbarStyle=this.options.toolbarStyle;this.useXHTML=this.options.useXHTML;this.fileLister=this.options.fileLister;this.editorCss=this.options.editorCss;this.disableSourceView=this.options.disableSourceView;this.editorDiv=null;this.toolbar=null;this.iframe=null;this.iframeDiv=null;this.isEnabled=false;this.sourceCheckbox=null;this.inSourceView=false;this.activeDialog=null;this.selectedRange=null;this.keyPressListener=this.keyPressHandler.bindAsEventListener(this);this.cancelKeyPressListener=this.cancelKeyPressHandler.bindAsEventListener(this);this.keyUpListener=this.keyUpHandler.bindAsEventListener(this);this.clickListener=this.updateToolbarState.bindAsEventListener(this);this.closeDialogListener=this.closeDialog.bindAsEventListener(this);this.escKeyListener=this.escKeyPressed.bindAsEventListener(this);this.iframeTabListener=this.tabKeyPressed.bindAsEventListener(this);this.focusListener=this.focus.bindAsEventListener(this);this.changeListener=this.syncToEditor.bindAsEventListener(this);this.submitListener=function(d){this.syncToTextarea();return true}.bindAsEventListener(this);var c=navigator.userAgent.toLowerCase();this.isIE=((c.indexOf("msie")!=-1)&&(c.indexOf("opera")==-1)&&(c.indexOf("webtv")==-1));this.isGecko=(c.indexOf("gecko")!=-1);this.createEditor();this.destructor=Event.on(window,"unload",this.destroy.bind(this))},createEditor:function(){var b=this.textarea.parentNode;var c=this.textarea.offsetWidth?this.textarea.offsetWidth+"px":this.textarea.style.width;var l=this.textarea.offsetHeight?this.textarea.offsetHeight+"px":this.textarea.style.height;var g=document.createElement("div");if(c){g.style.width=c}this.toolbar=new Control.RTE.Toolbar(this,this.toolbarStyle);if(this.options.variables){this.toolbar.add(new Control.RTE.ToolbarLineBreak());this.toolbar.add(new Control.RTE.ToolbarVariableList("varlist",this.options.variables,"Insert Field",this.options.variableClass))}var h=document.createElement("div");h.className="rteEditor";this.iframeDiv=h;var k=document.createElement("div");k.style.borderTop="1px solid #999999";if(!this.disableSourceView){k.className="rteFooter";var f=document.createElement("input");f.type="checkbox";f.id=this.textarea.name+"_viewsource";f.onclick=this.toggleSourceView.bindAsEventListener(this);this.sourceCheckbox=f;k.appendChild(f);var j=document.createElement("label");j.htmlFor=f.id;j.innerHTML="View HTML Source - ";k.appendChild(j);clearFormatting=document.createElement("span");clearFormatting.onclick=function(i){if(confirm("Are you sure you want to clear all text formatting?")){this.clearFormatting()}return false}.bindAsEventListener(this);clearFormatting.innerHTML="Clear All Formatting";clearFormatting.style.textDecoration="underline";clearFormatting.style.color="blue";clearFormatting.style.cursor="pointer";k.appendChild(clearFormatting)}g.appendChild(this.toolbar.element);g.appendChild(h);g.appendChild(k);this.editorDiv=g;Element.hide(this.textarea);b.insertBefore(g,this.textarea);var d=document.createElement("iframe");d.width="100%";if(l){if(g.offsetHeight>0){d.height=parseInt(l)-g.offsetHeight}else{d.height=parseInt(l)-83}}d.style.border=0;d.style.margin=0;this.iframe=d;h.appendChild(d);this.createEditDoc();Event.observe(this.getIframeWindow().document,"click",this.closeDialogListener);Event.observe(document,"keypress",this.escKeyListener);Control.RTE.activeEditor=this;if(document.all){this.iframe.tabIndex=this.textarea.tabIndex}else{var e;var a=this.textarea.form.elements;for(e=0;e<a.length;++e){if(a[e]==this.textarea){break}if(!a[e].hidden){this.prevElement=a[e]}}if(a.length>e+1){this.nextElement=a[e+1]}if(this.prevElement){Event.observe(this.prevElement,"keypress",function(i){if(i.keyCode==Event.KEY_TAB&&!i.shiftKey){this.focus();return false}}.bindAsEventListener(this))}if(this.nextElement){Event.observe(this.nextElement,"keypress",function(i){if(i.keyCode==Event.KEY_TAB&&i.shiftKey){this.focus();return false}}.bindAsEventListener(this))}Event.observe(this.getIframeWindow().document,"keypress",this.iframeTabListener,true)}Event.observe(this.textarea,"change",this.changeListener);Event.observe(this.textarea,"focus",this.focusListener);Event.observe(this.textarea.form,"submit",this.submitListener);this.textarea.store("editor",this);return true},tabKeyPressed:function(a){if(a.keyCode==Event.KEY_TAB){this.moveFocus(a.shiftKey?this.prevElement:this.nextElement);Event.stop(a)}},focus:function(a){this.textarea.blur();this.getIframeWindow().focus()},moveFocus:function(a){if(a){if(a.editor){a.editor.focus.bind(a.editor)()}else{a.focus()}}},destroy:function(){Event.stopObserving(document,"keypress",this.escKeyListener);Event.stopObserving(this.textarea.form,"submit",this.submitListener);Event.stopObserving(this.textarea,"change",this.changeListener);Event.stopObserving(this.textarea,"focus",this.focusListener);var a=this.getIframeWindow().document;Event.stopObserving(a,"keypress",this.iframeTabListener,true);Event.stopObserving(a,"click",this.closeDialogListener);Event.stopObserving(a,"keypress",this.keyPressListener,true);Event.stopObserving(a,"keyup",this.keyUpListener,true);Event.stopObserving(a,"click",this.clickListener,true);Element.remove(this.editorDiv);this.editorDiv=null;this.iframe=null;this.sourceCheckbox=null;this.destructor.stop();this.textarea.store("editor",null);Element.show(this.textarea)},enable:function(){if(!this.isEnabled){try{var b=this.iframe.contentWindow.document;b.designMode="On";this.toolbar.enable();this.updateToolbarState();Event.stopObserving(b,"keypress",this.cancelKeyPressListener,true);Event.observe(b,"keypress",this.keyPressListener,true);Event.observe(b,"keyup",this.keyUpListener,true);Event.observe(b,"click",this.clickListener,true);if(this.sourceCheckbox){this.sourceCheckbox.disabled=false}this.isEnabled=true}catch(a){if(this.isGecko){setTimeout(this.enable.bind(this),10)}return false}}},disable:function(){if(this.isEnabled){var a=this.iframe.contentWindow.document;a.designMode="Off";this.toolbar.disable();Event.stopObserving(a,"keypress",this.keyPressListener,true);Event.stopObserving(a,"keyup",this.keyUpListener,true);Event.stopObserving(a,"click",this.clickListener,true);Event.observe(a,"keypress",this.cancelKeyPressListener,true);if(this.sourceCheckbox){this.sourceCheckbox.disabled=true}this.isEnabled=false}},createEditDoc:function(){var a=this.iframe.contentWindow.document;a.open();a.write(this.getEditorDoc(this.markupVariables(this.textarea.value),this.editorCss));a.close();this.enable()},updateToolbarState:function(){this.toolbar.refresh()},clearSelection:function(){var b=this.getIframeWindow();if(document.all){var a=b.document.selection;a.empty()}else{var a=b.getSelection();a.removeAllRanges()}this.selectedRange=null},getSelectedText:function(){if(this.selectedRange){if(this.isIE){return new String(this.selectedRange.htmlText).stripTags()}else{return this.selectedRange.toString().stripTags()}}return""},closeDialog:function(a){Control.RTE.Dialog.destroyActive()},showDialog:function(b,d){if(this.activeDialog==b){Control.RTE.Dialog.closeActive();return}var c=this.getIframeWindow();if(document.all){var a=c.document.selection;if(a){this.selectedRange=a.createRange()}}else{var a=c.getSelection();if(a&&a.rangeCount>0){this.selectedRange=a.getRangeAt(a.rangeCount-1).cloneRange()}}switch(b){case"textcolor":case"bgcolor":Control.RTE.Dialog.activate("ColorPalette",this,Event.element(d));break;case"link":Control.RTE.Dialog.activate("InsertLink",this,Event.element(d));break;case"image":Control.RTE.Dialog.activate("ImageBrowser",this,null,{fileLister:this.fileLister});break;case"table":Control.RTE.Dialog.activate("InsertTable",this,Event.element(d));break;default:new Control.RTE.Dialog(this,Event.element(d))}Control.RTE.activeEditor=this;this.activeDialog=b},setDialogColor:function(a){if(document.all&&this.selectedRange){this.selectedRange.select()}if(this.activeDialog=="textcolor"){this.doCommand("forecolor",a)}else{if(document.all){this.doCommand("backcolor",a)}else{this.doCommand("hilitecolor",a)}}setTimeout(Control.RTE.Dialog.closeActive)},insertHtml:function(a){var b=this.getIframeWindow();b.focus();if(document.all){if(this.selectedRange){this.selectedRange.pasteHTML(a);this.selectedRange.collapse(false);this.selectedRange.select()}else{}}else{b.document.execCommand("insertHTML",false,a)}setTimeout(Control.RTE.Dialog.closeActive)},getIframeWindow:function(){return this.iframe.contentWindow},doCommand:function(d,b){clearTimeout(this.syncTimeout);var a=this.getIframeWindow();try{a.focus();a.document.execCommand(d,false,b);a.focus()}catch(c){return false}this.updateToolbarState();this.syncTimeout=setTimeout(this.syncToTextarea.bind(this),1000);return true},debug:function(b){if(!this.debugElement){var a=document.createElement("div");a.style.position="absolute";a.style.top=0;a.style.width="100%";a.style.backgroundColor="#FFFFCC";a.style.MozOpacity=".8";a.style.height="125px";a.style.overflow="auto";a.style.fontFamily="monospace";a.style.borderBottom="1px solid black";this.debugElement=a;document.body.appendChild(this.debugElement);window.onscroll=function(){a.style.top=window.pageYOffset+"px"}}this.debugElement.appendChild(document.createTextNode(b));this.debugElement.appendChild(document.createElement("br"));if(this.debugElement.scrollHeight>125){this.debugElement.scrollTop=this.debugElement.scrollHeight-125}},checkCommand:function(c){var a=this.getIframeWindow();try{return a.document.queryCommandState(c)}catch(b){return false}},checkCommandValue:function(c){var a=this.getIframeWindow();try{return a.document.queryCommandValue(c)}catch(b){return false}},commandEnabled:function(c){var a=this.getIframeWindow();try{return a.document.queryCommandEnabled(c)}catch(b){return false}},getEditorDoc:function(b,c){var a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n';a+="<html>\n";a+="<head>\n";if(c){a+='<link media="all" type="text/css" href="'+c+'" rel="stylesheet">\n'}else{a+='<style type="text/css">\n';a+="body {\n";a+="	background: #FFFFFF;\n";a+="	margin: 2px;\n";a+="	padding: 2px;\n";a+="	font-family: sans-serif;\n";a+="	font-size: 10pt;\n";a+="}\n";a+="</style>\n"}a+='<style type="text/css">\n';a+="body.source {\n";a+="  white-space: pre;\n";a+="  font-family: monospace;\n";a+="  background-color: #FFFFDD;\n";a+="}\n";a+="</style>\n";a+="</head>\n";a+="<body>\n";a+=b+"\n";a+="</body>\n";a+="</html>";return a},toggleSourceView:function(d){var a=this.sourceCheckbox.checked;var c=this.getIframeWindow();var b=c.document;this.syncToTextarea();if(a&&!this.inSourceView){this.inSourceView=true;this.toolbar.disable();if(this.isGecko){b.body.className="source"}this.syncToEditor()}else{if(!a&&this.inSourceView){this.inSourceView=false;if(this.isGecko){b.body.className=""}if(this.isEnabled){this.toolbar.enable()}this.syncToEditor()}}c.focus()},escKeyPressed:function(a){if(a.keyCode==Event.KEY_ESC){Control.RTE.Dialog.destroyActive()}},keyPressHandler:function(b){if(this.isGecko&&b.ctrlKey){var a=String.fromCharCode(b.charCode).toLowerCase();var c=null;switch(a){case"b":c="bold";break;case"i":c="italic";break;case"u":c="underline";break}if(c){this.doCommand(c,false,null);this.updateToolbarState();Event.stop(b)}}},cancelKeyPressHandler:function(a){Event.stop(a)},keyUpHandler:function(a){clearTimeout(this.syncTimeout);if(a.keyCode==Event.KEY_DOWN||a.keyCode==Event.KEY_UP||a.keyCode==Event.KEY_LEFT||a.keyCode==Event.KEY_RIGHT||a.keyCode==Event.KEY_RETURN||a.keyCode==33||a.keyCode==34||a.keyCode==35||a.keyCode==36){this.updateToolbarState()}this.syncTimeout=setTimeout(this.syncToTextarea.bind(this),1000)},markupVariables:function(b){if(this.options.variableClass&&this.options.variableExpression){var a=new RegExp("("+this.options.variableExpression+")","gm");b=b.replace(a,'<span class="'+this.options.variableClass+'">$1</span>')}return b},unmarkupVariables:function(b){if(this.options.variableClass){var a=new RegExp('<span class="'+this.options.variableClass+'">([^<]*)</span>',"gm");b=b.replace(a,"$1")}return b},setText:function(a){this.textarea.value=a;this.syncToEditor()},getText:function(){if(this.isEnabled){this.syncToTextarea()}return this.textarea.value},syncToTextarea:function(){clearTimeout(this.syncTimeout);var a=this.getNodeText(this.getIframeWindow().document.body,!this.inSourceView);a=this.unmarkupVariables(a);this.textarea.value=this.trimWhitespace(this.escapeText(a))},getNodeText:function(b,c){var e;if(!c){if(document.all){e=escape(b.innerText);e=e.replace("%3CP%3E%0D%0A%3CHR%3E","%3CHR%3E");e=unescape(e.replace("%3CHR%3E%0D%0A%3C/P%3E","%3CHR%3E"))}else{var d=b.ownerDocument.createRange();d.selectNodeContents(b);e=d.toString()}if(this.useXHTML){var a=document.createElement("div");a.innerHTML=e;e=get_xhtml(a)}}else{if(this.useXHTML){e=get_xhtml(b)}else{e=b.innerHTML}}return e},escapeText:function(b){for(var a=0;a<b.length;++a){var c=b.charCodeAt(a);if(c==13){b=b.substring(0,a).concat(b.substring(a+1,b.length))}else{if(c>128){if(c==39||c==145||c==146||c==8217||c==8216){b=b.substring(0,a).concat("&apos;",b.substring(a+1,b.length))}else{if(c==34||c==147||c==148||c==8220||c==8221){b=b.substring(0,a).concat("&quot;",b.substring(a+1,b.length))}else{if(c==150||c==8211){b=b.substring(0,a).concat("-",b.substring(a+1,b.length))}else{if(c==153||c==8482){b=b.substring(0,a).concat("&trade;",b.substring(a+1,b.length))}else{b=b.substring(0,a).concat("&#",String(c),";",b.substring(a+1,b.length))}}}}}}}return b},trimWhitespace:function(d){var f=0;var a=-1;for(var b=0;b<d.length;++b){var e=d.charCodeAt(b);switch(d.charCodeAt(b)){case 32:case 8:case 10:case 13:if(a==-1){f=b+1}break;default:a=b}}if(a==-1){return""}return d.substr(f,(a+1)-f)},clearFormatting:function(){var a=document.createElement("div");a.innerHTML=this.getText();this.removeNodeFormatting(a);this.textarea.value=this.getNodeText(a,!this.inSourceView);this.syncToEditor()},removeNodeFormatting:function(b){if(b.childNodes.length>0){for(var a=0;a<b.childNodes.length;++a){var c=b.childNodes[a];if(c.nodeType==1){this.removeNodeFormatting(c);switch(c.nodeName.toLowerCase()){case"p":case"br":case"img":case"a":break;default:a+=c.childNodes.length-1;while(c.firstChild){b.insertBefore(c.firstChild,c)}b.removeChild(c)}}}}},syncToEditor:function(){var a=this.getIframeWindow().document;if(this.inSourceView){if(document.all){a.body.innerText=this.textarea.value}else{var b=a.createTextNode(this.textarea.value);a.body.innerHTML="";a.body.appendChild(b)}}else{a.body.innerHTML=this.markupVariables(this.textarea.value)}}};Control.RTE.Toolbar=Class.create();Object.extend(Control.RTE.Toolbar.prototype,{initialize:function(a,b){this.editor=a;this.items=[];this.element=document.createElement("div");this.element.className="rteToolbar";this.addLayout(b)},add:function(a){a.toolbar=this;this.items.push(a);this.element.appendChild(a.element)},addSeparator:function(){this.add(new Control.RTE.ToolbarSeparator())},addLineBreak:function(){this.add(new Control.RTE.ToolbarLineBreak())},disable:function(){this.disabled=true;Element.addClassName(this.element,"rteToolbarDisabled");this.items.each(function(a){a.disable()})},enable:function(){this.disabled=false;Element.removeClassName(this.element,"rteToolbarDisabled");this.items.each(function(a){a.enable()})},refresh:function(){if(!this.toolbarRefreshing){this.toolbarRefreshing=true;this.items.each(function(a){a.refresh()});if(this.toolbarNeedsRefresh){this.refresh()}this.toolbarRefreshing=false;this.toolbarNeedsRefresh=false}else{this.toolbarNeedsRefresh=true}},addLayout:function(a){if(a=="simple"){this.add(Control.RTE.ToolbarButton.BOLD());this.add(Control.RTE.ToolbarButton.ITALIC());this.add(Control.RTE.ToolbarButton.UNDERLINE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.UNDO());this.add(Control.RTE.ToolbarButton.REDO())}else{if(a=="html"){this.add(Control.RTE.ToolbarButton.BOLD());this.add(Control.RTE.ToolbarButton.ITALIC());this.add(Control.RTE.ToolbarButton.UNDERLINE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.UNDO());this.add(Control.RTE.ToolbarButton.REDO());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.TEXT_COLOR());this.add(Control.RTE.ToolbarButton.BACKGROUND_COLOR());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.INSERT_LINK());this.add(Control.RTE.ToolbarButton.INSERT_IMAGE())}else{if(a=="advanced"){this.add(Control.RTE.ToolbarButton.BOLD());this.add(Control.RTE.ToolbarButton.ITALIC());this.add(Control.RTE.ToolbarButton.UNDERLINE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.LEFT_JUSTIFY());this.add(Control.RTE.ToolbarButton.CENTER_JUSTIFY());this.add(Control.RTE.ToolbarButton.RIGHT_JUSTIFY());this.add(Control.RTE.ToolbarButton.FULL_JUSTIFY());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.UNDO());this.add(Control.RTE.ToolbarButton.REDO());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.HORIZONTAL_RULE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.ORDERED_LIST());this.add(Control.RTE.ToolbarButton.UNORDERED_LIST());this.add(Control.RTE.ToolbarButton.OUTDENT());this.add(Control.RTE.ToolbarButton.INDENT());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.TEXT_COLOR());this.add(Control.RTE.ToolbarButton.BACKGROUND_COLOR());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.INSERT_LINK());this.add(Control.RTE.ToolbarButton.INSERT_IMAGE());this.add(Control.RTE.ToolbarButton.INSERT_TABLE())}else{this.add(Control.RTE.ToolbarButton.FONT_FACE());this.add(Control.RTE.ToolbarButton.FONT_SIZE());this.add(Control.RTE.ToolbarButton.BLOCK_STYLE());this.add(new Control.RTE.ToolbarLineBreak());this.add(Control.RTE.ToolbarButton.BOLD());this.add(Control.RTE.ToolbarButton.ITALIC());this.add(Control.RTE.ToolbarButton.UNDERLINE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.LEFT_JUSTIFY());this.add(Control.RTE.ToolbarButton.CENTER_JUSTIFY());this.add(Control.RTE.ToolbarButton.RIGHT_JUSTIFY());this.add(Control.RTE.ToolbarButton.FULL_JUSTIFY());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.UNDO());this.add(Control.RTE.ToolbarButton.REDO());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.HORIZONTAL_RULE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.ORDERED_LIST());this.add(Control.RTE.ToolbarButton.UNORDERED_LIST());this.add(Control.RTE.ToolbarButton.OUTDENT());this.add(Control.RTE.ToolbarButton.INDENT());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.TEXT_COLOR());this.add(Control.RTE.ToolbarButton.BACKGROUND_COLOR());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.INSERT_LINK());this.add(Control.RTE.ToolbarButton.INSERT_IMAGE());this.add(Control.RTE.ToolbarButton.INSERT_TABLE())}}}}});Control.RTE.ToolbarItem=new Object();Object.extend(Control.RTE.ToolbarItem,{element:null,toolbar:null,refresh:Prototype.emptyFunction,enable:Prototype.emptyFunction,disable:Prototype.emptyFunction});Control.RTE.ToolbarSeparator=Class.create();Object.extend(Control.RTE.ToolbarSeparator.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarSeparator.prototype,{initialize:function(){var a=document.createElement("img");a.className="rteVertSep";a.src=Control.RTE.includePath+"separator.gif";a.width=1;a.height=20;this.element=a}});Control.RTE.ToolbarLineBreak=Class.create();Object.extend(Control.RTE.ToolbarLineBreak.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarLineBreak.prototype,{initialize:function(){this.element=document.createElement("hr");this.element.className="rteHorizSep"}});Control.RTE.ToolbarButton=Class.create();Object.extend(Control.RTE.ToolbarButton.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarButton.prototype,{initialize:function(c,a,b){this.element=this.createButton(c,a,b)},createButton:function(d,b,c){var a=document.createElement("img");a.id=d;a.className="rteButton";a.src=Control.RTE.includePath+b;a.width=25;a.height=24;a.alt=c;a.title=c;this.addCommonBehavior(a);this.addButtonBehavior(a);return a},addButtonBehavior:function(a){this.addButtonActionBehavior(a)},addButtonActionBehavior:function(a,b){a.onclick=function(c){if(!this.toolbar.disabled){(b||Prototype.emptyFunction).bind(this)(c)}}.bindAsEventListener(this);a.onmousedown=function(c){if(!this.toolbar.disabled){Element.addClassName(Event.element(c),"rteButtonActive");Element.removeClassName(Event.element(c),"rteButtonHover")}return false}.bindAsEventListener(this);a.onmouseup=function(c){if(!this.toolbar.disabled){Element.removeClassName(Event.element(c),"rteButtonActive");Element.addClassName(Event.element(c),"rteButtonHover")}}.bindAsEventListener(this);a.onmouseover=function(c){if(!this.toolbar.disabled&&!Element.hasClassName(Event.element(c),"rteButtonActive")){Element.addClassName(Event.element(c),"rteButtonHover")}}.bindAsEventListener(this);a.onmouseout=function(c){if(!this.toolbar.disabled){Element.removeClassName(Event.element(c),"rteButtonHover")}Element.removeClassName(Event.element(c),"rteButtonActive")}.bindAsEventListener(this)},addCommonBehavior:function(a){a.onmousedown=function(){return false};a.onselectstart=function(){return false}},disable:function(){Element.setOpacity(this.element,0.3)},enable:function(){Element.setOpacity(this.element,1)}});Control.RTE.ToolbarCommandButton=Class.create();Object.extend(Control.RTE.ToolbarCommandButton.prototype,Control.RTE.ToolbarButton.prototype);Object.extend(Control.RTE.ToolbarCommandButton.prototype,{initialize:function(e,b,d,c,a){this.command=c;this.noSync=a;this.element=this.createButton(e,b,d)},addButtonBehavior:function(a){if(this.noSync){this.addButtonActionBehavior(a,function(b){return this.toolbar.editor.doCommand(this.command)}.bindAsEventListener(this))}else{this.addButtonStateBehavior(a,function(b){return this.toolbar.editor.doCommand(this.command)}.bindAsEventListener(this))}},addButtonStateBehavior:function(a,b){a.onmousedown=function(c){if(!this.toolbar.disabled&&b(c)){if(this.toolbar.editor.checkCommand(this.command)){Element.addClassName(Event.element(c),"rteButtonActive");Element.removeClassName(Event.element(c),"rteButtonHover")}else{Element.removeClassName(Event.element(c),"rteButtonActive");Element.addClassName(Event.element(c),"rteButtonHover")}}return false}.bindAsEventListener(this);a.onmouseover=function(c){if(!this.toolbar.disabled&&!Element.hasClassName(Event.element(c),"rteButtonActive")){Element.addClassName(Event.element(c),"rteButtonHover")}}.bindAsEventListener(this);a.onmouseout=function(c){if(!this.toolbar.disabled){Element.removeClassName(Event.element(c),"rteButtonHover")}}.bindAsEventListener(this)},refresh:function(){if(this.toolbar.editor.checkCommand(this.command)){Element.addClassName(this.element,"rteButtonActive")}else{Element.removeClassName(this.element,"rteButtonActive")}}});Control.RTE.ToolbarDialogButton=Class.create();Object.extend(Control.RTE.ToolbarDialogButton.prototype,Control.RTE.ToolbarButton.prototype);Object.extend(Control.RTE.ToolbarDialogButton.prototype,{initialize:function(d,a,c,b){this.dialogType=b;this.element=this.createButton(d,a,c)},addButtonBehavior:function(a){this.addButtonActionBehavior(a,function(b){return this.toolbar.editor.showDialog(this.dialogType,b)}.bindAsEventListener(this))}});Control.RTE.ToolbarCommandList=Class.create();Object.extend(Control.RTE.ToolbarCommandList.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarCommandList.prototype,{initialize:function(d,a,c,b){this.command=b;this.element=this.createList(d,a,c)},createList:function(d,b,c){var a=new Element("select",{id:d});a.appendChild(new Element("option",{value:""}).insert({top:c}));if(b.constructor==Array){b.each(function(e){a.appendChild(new Element("option",{value:e}).insert({top:e}))})}else{$H(b).each(function(e){a.appendChild(new Element("option",{value:e[0]}).insert({top:e[1]}))})}this.applyBehavior(a);return a},applyBehavior:function(a){a.onchange=this.valueChanged.bindAsEventListener(this)},valueChanged:function(c){if(!this.toolbar.disabled){var a=Event.element(c);var b=a.options[a.selectedIndex].value;this.toolbar.editor.doCommand(this.command,b)}},refresh:function(){var b=this.toolbar.editor.checkCommandValue(this.command);for(var a=0;a<this.element.options.length;++a){if(this.element.options[a].value==b){this.element.selectedIndex=a}break}},disable:function(){this.element.disabled=true},enable:function(){this.element.disabled=false}});Control.RTE.ToolbarVariableList=Class.create();Object.extend(Control.RTE.ToolbarVariableList.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarVariableList.prototype,{initialize:function(d,b,c,a){this.spanClass=a;this.element=this.createList(d,b,c)},createList:function(d,b,c){var a=new Element("select",{id:d});a.appendChild(new Element("option",{value:""}).insert({top:c}));b.each(function(e){a.appendChild(new Element("option",{value:e}).insert({top:e}))});this.applyBehavior(a);return a},applyBehavior:function(a){a.onchange=this.valueChanged.bindAsEventListener(this)},valueChanged:function(c){if(!this.toolbar.disabled){var a=Event.element(c);var b=a.options[a.selectedIndex].value;if(b){if(this.spanClass){b='<span class="'+this.spanClass+'">'+b+"</span>&nbsp;"}this.toolbar.editor.insertHtml(b)}a.selectedIndex=0}},disable:function(){this.element.disabled=true},enable:function(){this.element.disabled=false}});Control.RTE.ToolbarButton.FONT_FACE=function(){return new Control.RTE.ToolbarCommandList("rteFontFace",{serif:"Serif","sans-serif":"Sans Serif",monospace:"Monospace"},"Font","fontname")};Control.RTE.ToolbarButton.FONT_SIZE=function(){return new Control.RTE.ToolbarCommandList("rteFontSize",{"1":"-1","2":"Normal","3":"+1","4":"+2","5":"+3","6":"+4","7":"+5"},"Font Size","fontsize")};Control.RTE.ToolbarButton.BLOCK_STYLE=function(){return new Control.RTE.ToolbarCommandList("rteBlockStyle",{span:"No Style",p:"Paragraph",pre:"Preformatted",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",address:"Address"},"Style","formatblock")};Control.RTE.ToolbarButton.BOLD=function(){return new Control.RTE.ToolbarCommandButton("rteBold","bold.gif","Bold","bold")};Control.RTE.ToolbarButton.ITALIC=function(){return new Control.RTE.ToolbarCommandButton("rteItalic","italic.gif","Italic","italic")};Control.RTE.ToolbarButton.UNDERLINE=function(){return new Control.RTE.ToolbarCommandButton("rteUnderline","underline.gif","Underline","underline")};Control.RTE.ToolbarButton.LEFT_JUSTIFY=function(){return new Control.RTE.ToolbarCommandButton("rteLeftJustify","left_just.gif","Align Left","justifyleft")};Control.RTE.ToolbarButton.CENTER_JUSTIFY=function(){return new Control.RTE.ToolbarCommandButton("rteCenterJustify","centre.gif","Align Center","justifycenter")};Control.RTE.ToolbarButton.RIGHT_JUSTIFY=function(){return new Control.RTE.ToolbarCommandButton("rteRightJustify","right_just.gif","Align Right","justifyright")};Control.RTE.ToolbarButton.FULL_JUSTIFY=function(){return new Control.RTE.ToolbarCommandButton("rteFullJustify","justifyfull.gif","Full Justified","justifyfull")};Control.RTE.ToolbarButton.UNDO=function(){return new Control.RTE.ToolbarCommandButton("rteUndo","undo.gif","Undo","undo",true)};Control.RTE.ToolbarButton.REDO=function(){return new Control.RTE.ToolbarCommandButton("rteRedo","redo.gif","Redo","redo",true)};Control.RTE.ToolbarButton.HORIZONTAL_RULE=function(){return new Control.RTE.ToolbarCommandButton("rteHorizontalRule","hr.gif","Horizontal Rule","inserthorizontalrule",true)};Control.RTE.ToolbarButton.ORDERED_LIST=function(){return new Control.RTE.ToolbarCommandButton("rteOrderedList","numbered_list.gif","Ordered List","insertorderedlist")};Control.RTE.ToolbarButton.UNORDERED_LIST=function(){return new Control.RTE.ToolbarCommandButton("rteUnorderedList","list.gif","Unordered List","insertunorderedlist")};Control.RTE.ToolbarButton.OUTDENT=function(){return new Control.RTE.ToolbarCommandButton("rteOutdent","outdent.gif","Outdent","outdent",true)};Control.RTE.ToolbarButton.INDENT=function(){return new Control.RTE.ToolbarCommandButton("rteIndent","indent.gif","Indent","indent",true)};Control.RTE.ToolbarButton.TEXT_COLOR=function(){return new Control.RTE.ToolbarDialogButton("rteTextColor","textcolor.gif","Text Color","textcolor")};Control.RTE.ToolbarButton.BACKGROUND_COLOR=function(){return new Control.RTE.ToolbarDialogButton("rteBackgroundColor","bgcolor.gif","Background Color","bgcolor")};Control.RTE.ToolbarButton.INSERT_LINK=function(){return new Control.RTE.ToolbarDialogButton("rteLink","hyperlink.gif","Insert Link","link")};Control.RTE.ToolbarButton.INSERT_IMAGE=function(){return new Control.RTE.ToolbarDialogButton("rteImage","image.gif","Insert Image","image")};Control.RTE.ToolbarButton.INSERT_TABLE=function(){return new Control.RTE.ToolbarDialogButton("rteTable","insert_table.gif","Insert Table","table")};Control.RTE.Dialog=Class.create();Object.extend(Control.RTE.Dialog,{activeEffect:null,activeDialog:null,closeActive:function(){if(Control.RTE.Dialog.activeDialog){if(Control.RTE.useEffects){if(Control.RTE.Dialog.activeEffect){Control.RTE.Dialog.activeEffect.cancel()}Control.RTE.Dialog.activeEffect=new Effect.SlideUp(Control.RTE.Dialog.activeDialog.dialogContainer,{afterFinish:Control.RTE.Dialog.destroyActive,duration:0.2})}else{Control.RTE.Dialog.destroyActive()}}},destroyActive:function(){if(Control.RTE.Dialog.activeDialog){if(Control.RTE.Dialog.activeEffect){Control.RTE.Dialog.activeEffect.cancel();Control.RTE.Dialog.activeEffect=null}Control.RTE.Dialog.activeDialog.destroy();Control.RTE.Dialog.activeDialog=null}},activate:function(c,d,b,a,e){Control.RTE.Dialog.destroyActive();Control.RTE.Dialog.activeDialog=Control.RTE.Dialog.cache[c];Control.RTE.Dialog.cache[c].activate(d,b,a,e)}});Object.extend(Control.RTE.Dialog.prototype,{initialize:function(){var a=Control.RTE.createElement("div",null,null,{position:"absolute"});var b=Control.RTE.createElement("div",null,"rteDialog");b.appendChild(this.create());a.appendChild(b);Element.hide(a);this.element=a},activate:function(f,e,i,h){this.editor=f;this.callback=h;this.editor.editorDiv.appendChild(this.element);if(e){var a=Position.cumulativeOffset(e);this.element.style.top=(a[1]+e.offsetHeight)+"px";var g=Position.cumulativeOffset(f.editorDiv)[0]+f.editorDiv.offsetWidth;var c=a[0];var b=Element.getDimensions(this.element).width;if(c+b>g){c=g-b}this.element.style.left=c+"px"}else{this.element.style.top=Position.cumulativeOffset(f.iframeDiv)[1]+"px";var b=Element.getDimensions(this.element).width;var d=f.editorDiv.offsetWidth;var c=((d-b)/2)+Position.cumulativeOffset(f.editorDiv)[0];this.element.style.left=c+"px"}this.refresh(i);if(Control.RTE.useEffects){Control.RTE.Dialog.activeEffect=new Effect.SlideDown(this.element,{afterFinish:this.dialogReady.bind(this),duration:0.2})}else{Element.show(this.element);this.dialogReady()}},refresh:function(a){},destroy:function(){Element.remove(this.element);if(this.editor){this.editor.activeDialog=null}this.editor=null;this.callback=null},dialogReady:function(a){if(Control.RTE.Dialog.activeEffect==a){Control.RTE.Dialog.activeEffect=null}if(Control.RTE.Dialog.activeDialog==this){(this.focus||Prototype.emptyFunction).bind(this)();(this.callback||Prototype.emptyFunction)();this.editor.getIframeWindow().blur();window.focus()}},create:function(){return document.createElement("div")}});Control.RTE.Dialog.ColorPalette=Class.create();Object.extend(Control.RTE.Dialog.ColorPalette.prototype,Control.RTE.Dialog.prototype);Object.extend(Control.RTE.Dialog.ColorPalette.prototype,{create:function(){this.colorpicker=new Control.ColorPicker.Panel({className:"rteColorPicker",onSelect:function(a){this.editor.setDialogColor(a)}.bind(this)});return this.colorpicker.element},focus:function(){Field.activate(this.colorpicker.customInput)}});Control.RTE.Dialog.InsertLink=Class.create();Object.extend(Control.RTE.Dialog.InsertLink.prototype,Control.RTE.Dialog.prototype);Object.extend(Control.RTE.Dialog.InsertLink.prototype,{create:function(){var i=document.createElement("div");var a=Control.RTE.createElement("table",{cellpadding:2,cellspacing:0,border:0});var g=a.insertRow(0);var f=g.insertCell(0);f.innerHTML="Title";f=g.insertCell(1);var h=Control.RTE.createElement("input",{id:"link_title",type:"text"},null,{width:"120px",border:"1px solid gray"});f.appendChild(h);var g=a.insertRow(1);var f=g.insertCell(0);f.innerHTML="URL";f=g.insertCell(1);var c=Control.RTE.createElement("input",{id:"link_url",type:"text"},null,{width:"120px",border:"1px solid gray"});f.appendChild(c);var g=a.insertRow(2);var f=g.insertCell(0);f.innerHTML="Tooltip";f=g.insertCell(1);f.appendChild(Control.RTE.createElement("input",{id:"link_tooltip",type:"text"},null,{width:"120px",border:"1px solid gray"}));var g=a.insertRow(3);var f=g.insertCell(0);f.innerHTML="&nbsp;";f=g.insertCell(1);f.appendChild(Control.RTE.createElement("input",{id:"link_newwindow",type:"checkbox"}));var e=Control.RTE.createElement("label",{"for":"link_newwindow"});e.innerHTML="New window";f.appendChild(e);var g=a.insertRow(4);var f=g.insertCell(0);f.colSpan=2;f.align="center";f.appendChild(Control.RTE.createElement("hr",null,"rteHorizSep"));var d=Control.RTE.createElement("input",{id:"link_insert",type:"submit",value:"Insert Link"},null,{border:"1px solid gray"});f.appendChild(d);var b=Control.RTE.createElement("form",{id:"link_form"},null,{margin:"0",padding:"0"});b.onsubmit=this.submitLinkListener();b.appendChild(a);i.appendChild(b);return i},focus:function(){var a=this.editor.getSelectedText();if(a&&a!=""){$("link_title").value=a;Field.activate("link_url")}else{Field.activate("link_title")}},submitLinkListener:function(){return function(a){var b='<a href="'+$("link_url").value+'"';if($("link_newwindow").checked){b+=' target="_new"'}if($("link_tooltip").value!=""){b+=' title="'+$("link_tooltip").value+'"'}b+=">"+$("link_title").value+"</a>";this.editor.insertHtml(b);return false}.bindAsEventListener(this)}});Control.RTE.Dialog.InsertTable=Class.create();Object.extend(Control.RTE.Dialog.InsertTable.prototype,Control.RTE.Dialog.prototype);Object.extend(Control.RTE.Dialog.InsertTable.prototype,{create:function(){var c=document.createElement("div");var d=Control.RTE.createElement("table",{cellpadding:2,cellspacing:0,border:0});var h=d.insertRow(0);var b=h.insertCell(0);b.innerHTML="Rows";b=h.insertCell(1);b.appendChild(Control.RTE.createElement("input",{id:"table_rows",type:"text",value:"2",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));var b=h.insertCell(2);b.width=5;b.innerHTML="&nbsp;";var b=h.insertCell(3);b.innerHTML="Columns";b=h.insertCell(4);b.appendChild(Control.RTE.createElement("input",{id:"table_cols",type:"text",value:"2",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));h=d.insertRow(1);b=h.insertCell(0);b.innerHTML="Width";b=h.insertCell(1);b.colSpan=4;b.appendChild(Control.RTE.createElement("input",{id:"table_width",type:"text",value:"100",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));var a=Control.RTE.createElement("select",{id:"table_width_type"},null,{border:"1px solid gray",marginLeft:"3px"});var f=Control.RTE.createElement("option",{value:"px"});f.innerHTML="pixels";a.appendChild(f);f=Control.RTE.createElement("option",{value:"%"});f.innerHTML="percent";f.selected=true;a.appendChild(f);b.appendChild(a);h=d.insertRow(2);b=h.insertCell(0);b.colSpan=5;b.appendChild(Control.RTE.createElement("hr",null,"rteHorizSep"));h=d.insertRow(3);b=h.insertCell(0);b.colSpan=3;b.innerHTML="Border width";b=h.insertCell(1);b.colSpan=2;b.appendChild(Control.RTE.createElement("input",{id:"table_border",type:"text",value:"1",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));h=d.insertRow(4);b=h.insertCell(0);b.colSpan=3;b.innerHTML="Cell spacing";b=h.insertCell(1);b.colSpan=2;b.appendChild(Control.RTE.createElement("input",{id:"table_cellspacing",type:"text",value:"1",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));h=d.insertRow(5);b=h.insertCell(0);b.colSpan=3;b.innerHTML="Cell padding";b=h.insertCell(1);b.colSpan=2;b.appendChild(Control.RTE.createElement("input",{id:"table_cellpadding",type:"text",value:"1",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));h=d.insertRow(6);b=h.insertCell(0);b.colSpan=5;b.align="center";b.appendChild(Control.RTE.createElement("hr",null,"rteHorizSep"));var g=Control.RTE.createElement("input",{id:"table_insert",type:"submit",value:"Insert Table"},null,{border:"1px solid gray"});b.appendChild(g);var e=Control.RTE.createElement("form",{id:"table_form"},null,{margin:"0",padding:"0"});e.onsubmit=this.submitTableListener();e.appendChild(d);c.appendChild(e);return c},submitTableListener:function(){return function(h){var b='<table border="'+$("table_border").value+'"';b+=' cellspacing="'+$("table_cellspacing").value+'"';b+=' cellpadding="'+$("table_cellpadding").value+'"';var d=$("table_width").value+$("table_width_type").options[$("table_width_type").selectedIndex].value;b+=' width="'+d+'">';var f=parseInt($("table_rows").value);var g=parseInt($("table_cols").value);for(var c=0;c<f;++c){b+="<tr>";for(var a=0;a<f;++a){b+="<td>&nbsp;</td>"}b+="</tr>"}b+="</table>";this.editor.insertHtml(b);return false}.bindAsEventListener(this)},focus:function(){$("table_rows").focus();$("table_rows").select()}});Control.RTE.Dialog.ImageBrowser=Class.create();Object.extend(Control.RTE.Dialog.ImageBrowser.prototype,Control.RTE.Dialog.prototype);Object.extend(Control.RTE.Dialog.ImageBrowser.prototype,{create:function(){var a=document.createElement("div");this.imageForm=this.createAttributeForm();a.appendChild(this.imageForm);return a},refresh:function(a){this.imageForm.reset();if(a&&a.fileLister&&typeof Control.FileChooser.Panel!="undefined"){if(!this.browser){this.browser=new Control.FileChooser.Panel(null,{className:"rteFileChooser",fileImage:Control.RTE.includePath+"/file.gif",directoryImage:Control.RTE.includePath+"/directory.gif",parentImage:Control.RTE.includePath+"/parent.gif",selectListener:function(b){$("image_url").value=b},previewListener:function(c,b){$("image_width").value=c;$("image_height").value=b},openListener:this.submitImageListener()});this.imageForm.parentNode.insertBefore(this.browser.getElement(),this.imageForm)}this.browser.fileLister=a.fileLister;this.browser.refresh(null)}},createAttributeForm:function(){var g=Control.RTE.createElement("form",{id:"image_form"},null,{margin:"0",padding:"0"});g.onsubmit=this.submitImageListener();var c=Control.RTE.createElement("table",{cellpadding:2,cellspacing:0,border:0});var f=c.insertRow(0);var b=f.insertCell(0);b.innerHTML="<nobr>Image URL</nobr>";b=f.insertCell(1);b.colSpan=7;b.appendChild(Control.RTE.createElement("input",{id:"image_url",type:"text"},null,{width:"295px",border:"1px solid gray"}));f=c.insertRow(1);b=f.insertCell(0);b.innerHTML="Width";b=f.insertCell(1);b.appendChild(Control.RTE.createElement("input",{id:"image_width",type:"text",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));b=f.insertCell(2);b.width=5;b.innerHTML="&nbsp;";b=f.insertCell(3);b.innerHTML="Height";b=f.insertCell(4);b.align="right";b.appendChild(Control.RTE.createElement("input",{id:"image_height",type:"text",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));b=f.insertCell(5);b.width=5;b.innerHTML="&nbsp;";b=f.insertCell(6);b.innerHTML="Alignment";b=f.insertCell(7);var a=Control.RTE.createElement("select",{id:"image_align"},null,{border:"1px solid gray"});var d=Control.RTE.createElement("option",{value:""});d.innerHTML="Default";d.selected=true;a.appendChild(d);d=Control.RTE.createElement("option",{value:"left"});d.innerHTML="Left";a.appendChild(d);d=Control.RTE.createElement("option",{value:"center"});d.innerHTML="Center";a.appendChild(d);d=Control.RTE.createElement("option",{value:"right"});d.innerHTML="Right";a.appendChild(d);b.appendChild(a);g.appendChild(c);c=Control.RTE.createElement("table",{cellpadding:2,cellspacing:0,border:0});f=c.insertRow(0);b=f.insertCell(0);b.innerHTML="Description";b=f.insertCell(1);b.appendChild(Control.RTE.createElement("input",{id:"image_title",type:"text"},null,{width:"295px",border:"1px solid gray"}));f=c.insertRow(1);b=f.insertCell(0);b.innerHTML="Alt text";b=f.insertCell(1);b.appendChild(Control.RTE.createElement("input",{id:"image_alt",type:"text"},null,{width:"295px",border:"1px solid gray"}));f=c.insertRow(2);b=f.insertCell(0);b.colSpan=2;b.appendChild(Control.RTE.createElement("hr",null,"rteHorizSep"));g.appendChild(c);var e=Control.RTE.createElement("div",null,null,{textAlign:"center"});e.appendChild(Control.RTE.createElement("input",{id:"image_insert",type:"submit",value:"Insert Image"},null,{border:"1px solid gray"}));g.appendChild(e);return g},createImageHtml:function(b,c,a,g,f,e){var d='<img src="'+b+'"';if(c&&c!=""){d+=' width="'+c+'"'}if(a&&a!=""){d+=' height="'+a+'"'}if(g&&g!=""){d+=' align="'+g+'"'}if(f&&f!=""){d+=' title="'+f+'"'}if(e&&e!=""){d+=' alt="'+e+'"'}d+=' border="0"/>';return d},submitImageListener:function(){return function(f){var b=$("image_url").value;var c=$("image_width").value;var a=$("image_height").value;var h=$("image_align").options[$("image_align").selectedIndex].value;var g=$("image_title").value;var d=$("image_alt").value;this.editor.insertHtml(this.createImageHtml(b,c,a,h,g,d));return false}.bindAsEventListener(this)}});if(typeof Protoplasm!="undefined"){Protoplasm.register("rte",Control.RTE)};if(window.Control==undefined){Control={}}Control.TabStrip=Class.create();Control.TabStrip.prototype={initialize:function(a,b){this.container=$(a);if(ts=this.container.retrieve("tabstrip")){ts.destroy()}Element.cleanWhitespace(this.container);this.options=Object.extend({activeClass:"active",inactiveClass:null,hoverClass:"hover",disabledClass:"disabled",onactivate:Prototype.emptyFunction,ondeactivate:Prototype.emptyFunction,disabled:false},b||{});this.tabs=new Array();this.createTabs(this.container,this.options);if(this.options.activeTab){this.switchTab(this.options.activeTab)}else{this.switchTabByIndex(0)}this.container.store("tabstrip",this);this.destructor=Event.on(window,"unload",this.destroy.bind(this))},createTabs:function(a){if(a.childNodes.length==2){var d=a.childNodes[0];Element.cleanWhitespace(d);var b=a.childNodes[1];Element.cleanWhitespace(b);if(d.childNodes.length==b.childNodes.length){for(var c=0;c<d.childNodes.length;++c){var e=new Control.TabStrip.Tab(this,d.childNodes[c],b.childNodes[c],this.options);if(this.options.disabled&&this.options.disabled.include(e.id)){e.disable()}this.tabs[this.tabs.length]=e}}}},destroy:function(){this.switchTabByIndex(0);for(var a=0;a<this.tabs.length;a++){this.tabs[a].destroy()}this.container.store("tabstrip",null);this.destructor.stop()},_switchTab:function(b){for(var a=0;a<this.tabs.length;++a){if(this.tabs[a]==b){return this.switchTabByIndex(a)}}},switchTab:function(a){for(var b=0;b<this.tabs.length;++b){if(this.tabs[b].id==a){return this.switchTabByIndex(b)}}},switchTabByIndex:function(a){if(!this.tabs[a].disabled){for(var b=0;b<this.tabs.length;++b){if(b==a){if(!this.tabs[b].active){this.tabs[b].activate()}}else{if(this.tabs[b].active){this.tabs[b].deactivate()}}}}},disableTab:function(a){for(var b=0;b<this.tabs.length;++b){if(this.tabs[b].id==a){this.tabs[b].disable()}}},enableTab:function(a){for(var b=0;b<this.tabs.length;++b){if(this.tabs[b].id==a){this.tabs[b].enable()}}}};Control.TabStrip.Tab=Class.create();Control.TabStrip.Tab.prototype={initialize:function(d,b,c,a){this.id=b.id;this.control=d;this.tabDiv=b;this.panel=new Control.TabStrip.Panel(c,this);this.options=a;this.active=false;this.disabled=false;this.listeners=[b.on("mouseover",this.hover.bindAsEventListener(this)),b.on("mouseout",this.restore.bindAsEventListener(this)),b.on("click",function(f){if(!this.active){this.control._switchTab(this)}}.bindAsEventListener(this)),b.on("mousedown",function(f){return false}.bindAsEventListener(this)),b.on("selectstart",function(f){return false}.bindAsEventListener(this))]},destroy:function(){for(var a=0;a<this.listeners.length;a++){this.listeners[a].stop()}},applyTabBehavior:function(a){},hover:function(a){if(!this.active&&!this.disabled){Element.addClassName(this.tabDiv,this.options.hoverClass)}},restore:function(a){Element.removeClassName(this.tabDiv,this.options.hoverClass)},activate:function(a){if(!this.disabled){this.restore();Element.removeClassName(this.tabDiv,this.options.inactiveClass);Element.addClassName(this.tabDiv,this.options.activeClass);this.panel.show();this.active=true;if(this.options.onactivate){this.options.onactivate(this)}}},deactivate:function(a){this.panel.hide();Element.removeClassName(this.tabDiv,this.options.activeClass);Element.addClassName(this.tabDiv,this.options.inactiveClass);this.active=false;if(this.options.ondeactivate){this.options.ondeactivate(this)}},enable:function(){Element.removeClassName(this.tabDiv,this.options.disabledClass);this.disabled=false},disable:function(){Element.addClassName(this.tabDiv,this.options.disabledClass);this.disabled=true}};Control.TabStrip.Panel=Class.create();Control.TabStrip.Panel.prototype={initialize:function(b,a){this.panelDiv=b;this.tab=a;this.applyPanelBehavior(b);this.hide()},applyPanelBehavior:function(a){},show:function(){Element.show(this.panelDiv)},hide:function(){Element.hide(this.panelDiv)}};if(typeof Protoplasm!="undefined"){Protoplasm.register("tabstrip",Control.TabStrip)};if(typeof Control=="undefined"){Control={}}Control.TickerBase=Class.create({initialize:function(b,c,a){this.options=Object.extend({interval:10,step:1},a||{});this.element=$(b);this.generator=c;this.element.style.overflow="hidden";this.scroller=new Element("div");this.element.appendChild(this.scroller);this.active=0;this.offset=0;this.start()},start:function(){this.timer=setInterval(function(){this.scroll(this.options.step)}.bind(this),this.options.interval)},scroll:function(d){var a=this.generator();var c=scroller.firstChild;var b=scroller.childNodes[scroller.childNodes.length-1]},stop:function(){if(this.timer){clearInterval(this.timer);this.timer=null}}});Control.Ticker=Class.create(Control.TickerBase,{initialize:function($super,c,b){var a=$(c).childElements();a.invoke("hide");$super(c,function(){return a.invoke("clone",true)},b)}});if(typeof Protoplasm!="undefined"){Protoplasm.register("ticker",Control.Ticker)};if(window.Control==undefined){Control={}}Control.TreeList=Class.create();Control.TreeList.prototype={initialize:function(b,a){this.element=$(b);Element.cleanWhitespace(this.element);this.options=Object.extend({expand:false,topOffset:0,triggerOutdent:0,collapseIconHover:"/images/icons/down_arrow_filled.gif",expandIconHover:"/images/icons/right_arrow_filled.gif",collapseIcon:"/images/icons/down_arrow_outline.gif",expandIcon:"/images/icons/right_arrow_outline.gif",contentMargin:"17px",singleClick:false,onCollapse:Prototype.emptyFunction,onExpand:Prototype.emptyFunction,onOpen:Prototype.emptyFunction},a||{});this.children=[];if(this.element.childNodes.length==2){this.title=this.element.childNodes[0];this.title.onmousedown=function(){return false};if(this.options.singleClick){this.title.style.cursor="pointer";this.title.onmouseover=this.onMouseOver.bindAsEventListener(this);this.title.onmouseout=this.onMouseOut.bindAsEventListener(this);this.title.onmousedown=this.toggle.bind(this)}else{this.title.ondblclick=this.toggle.bind(this)}this.title.onselectstart=function(){return false};this.trigger=document.createElement("img");if(this.options.triggerOutdent){Element.setStyle(this.title,{cursor:"default",position:"relative","margin-left":this.options.triggerOutdent});Element.setStyle(this.trigger,{position:"absolute",left:"-"+this.options.triggerOutdent,top:0+this.options.topOffset+"px"})}else{Element.setStyle(this.trigger,{"padding-right":"3px","padding-top":"1px","vertical-align":"text-top"})}if(!this.options.singleClick){this.trigger.onmousedown=this.toggle.bind(this);this.trigger.onmouseover=this.onMouseOver.bindAsEventListener(this);this.trigger.onmouseout=this.onMouseOut.bindAsEventListener(this)}this.updateIcon();this.title.insertBefore(this.trigger,this.title.firstChild);this.content=this.element.childNodes[1];this.content.style.marginLeft=this.options.contentMargin;if(!this.options.expand){this.collapse()}}this.element.treelist=this},toggle:function(){if(this.expanded){this.collapse()}else{this.expand()}},expand:function(){if(this.content){this.content.style.display="block";this.expanded=true;this.updateIcon();this.options.onExpand(this.element)}},collapse:function(){if(this.content){this.content.style.display="none";this.expanded=false;this.updateIcon();this.options.onCollapse(this.element)}},onMouseOver:function(a){this.hover=true;this.updateIcon()},onMouseOut:function(a){this.hover=false;this.updateIcon()},updateIcon:function(a){if(this.hover){if(!this.expanded){this.trigger.src=this.options.expandIconHover}else{this.trigger.src=this.options.collapseIconHover}}else{if(!this.expanded){this.trigger.src=this.options.expandIcon}else{this.trigger.src=this.options.collapseIcon}}}};Control.TreeItem=Class.create();Control.TreeItem.prototype={initialize:function(b,a){this.element=$(b);this.options=a||{};this.element.style.marginLeft=this.options.contentMargin;this.element.ondblclick=this.options.onOpen;this.element.onselectstart=function(){return false};this.element.style.cursor="default";this.element.style.cssFloat="left";this.element.style.clear="left"},open:function(){this.options.onOpen&&this.options.onOpen(this.element)}};if(typeof Protoplasm!="undefined"){Protoplasm.register("treelist",Control.TreeList)};if(window.Control==undefined){Control={}}Control.TreeSelect=function(b,d){var w=null;function s(y){y=y.replace(/^\s+/,"");for(var x=y.length-1;x>=0;x--){if(/\S/.test(y.charAt(x))){y=y.substring(0,x+1);break}}return y}function n(C,x){var z=[];var B=(x||document).getElementsByTagName("*");var A=new RegExp("\\b"+C+"\\b");for(var y=0;y<B.length;++y){if(B[y].className.match(A)){z[z.length]=B[y]}}return z}function l(y,z){cl=y.className?y.className.split(/ /):[];for(var x=0;x<cl.length;++x){if(cl[x]==z){return}}cl[cl.length]=z;y.className=cl.join(" ")}function m(y,A){if(!y.className){return}cl=y.className.split(/ /);var z=[];for(var x=0;x<cl.length;++x){if(cl[x]!=A){z[z.length]=cl[x]}}y.className=z.join(" ")}function u(x){var i=window.event||x;if(i.stopPropagation){i.stopPropagation()}else{i.cancelBubble=true}}function o(y,i,x){if(y.addEventListener){y.addEventListener(i,x,false)}else{y.attachEvent("on"+i,x)}}function r(y,i,x){if(y.removeEventListener){y.removeEventListener(i,x,false)}else{y.detachEvent("on"+i,x)}}function g(i){return function(x){if(w){clearTimeout(w);w=null}k.value=i.id;if(j.nodeName.toUpperCase()=="INPUT"){j.value=s(i.childNodes[0].nodeValue)}else{j.innerHTML=s(i.childNodes[0].nodeValue)}u(x);q(x);return false}}function a(i){return function(x){if(w){clearTimeout(w);w=null}w=setTimeout(function(){var y=[];if(i.getElementsByTagName("ul").length){y[0]=i.getElementsByTagName("ul")[0]}var E=i.parentNode;while(E&&E!=b){if(E.nodeName.toUpperCase()=="UL"){y[y.length]=E}E=E.parentNode}var B=[];var C=b.getElementsByTagName("ul");for(var A=0;A<C.length;++A){var D=false;for(var z=0;z<y.length;++z){if(y[z]==C[A]){D=true;break}}if(!D){B[B.length]=C[A]}}for(var A=0;A<y.length;++A){y[A].style.display="block";y[A].style.zIndex=99;l(y[A].parentNode,"active")}for(var A=0;A<B.length;++A){B[A].style.display="none";B[A].style.zIndex=0;m(B[A].parentNode,"active")}w=null},200);u(x);return false}}function v(i){if(!i.id&&i.getElementsByTagName("ul").length){o(i,"click",a(i))}else{o(i,"click",g(i))}o(i,"mouseover",a(i));var x=i.getElementsByTagName("ul");if(x.length){l(i,"submenu")}}var k=n("itemvalue",b)[0];var j=n("itemname",b)[0];var c=b.getElementsByTagName("ul")[0];function e(i){if(c.style.display=="block"){c.style.display="none"}else{return h(i)}}function h(i){c.style.display="block";o(document,"click",q);u(i);return false}function q(z){var y=c.getElementsByTagName("ul");for(var x=0;x<y.length;++x){y[x].style.display="none";y[x].style.zIndex=0;m(y[x].parentNode,"active")}c.style.display="none";r(document,"click",q)}var t=document.createElement("img");t.src="/images/dropdown.png";t.style.verticalAlign="middle";if(j.nextSibling){j.parentNode.insertBefore(t,j.nextSibling)}else{j.parentNode.appendChild(t)}o(t,"click",e);o(j,"click",h);j.readOnly=true;var f=b.getElementsByTagName("li");for(var p=0;p<f.length;++p){v(f[p])}return{element:b}};if(typeof Protoplasm!="undefined"){Protoplasm.register("treeselect",Control.TreeSelect)};